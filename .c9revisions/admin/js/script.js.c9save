{"ts":1365246931722,"patch":[[{"diffs":[[0,"edCats.l"],[-1,",p.categories"],[1,"ength>0"],[0,")){\r\n   "]],"start1":62879,"start2":62879,"length1":29,"length2":23}]],"length":111744,"saved":false}
{"ts":1365247004459,"patch":[[{"diffs":[[0,"    "],[-1,"updated.categories = this.selectedCats"],[1,"var\r\n                newProduct.set({categories:})"],[0,";\r\n "]],"start1":62911,"start2":62911,"length1":46,"length2":58}]],"length":111756,"saved":false}
{"ts":1365247005474,"patch":[[{"diffs":[[0,"     var"],[1," sc"],[0,"\r\n      "]],"start1":62910,"start2":62910,"length1":16,"length2":19}]],"length":111759,"saved":false}
{"ts":1365247006241,"patch":[[{"diffs":[[0,"  var sc"],[1,"="],[0,"\r\n      "]],"start1":62913,"start2":62913,"length1":16,"length2":17}]],"length":111760,"saved":false}
{"ts":1365247014139,"patch":[[{"diffs":[[0," var sc="],[1,"this.selectedCats"],[0,"\r\n      "]],"start1":62914,"start2":62914,"length1":16,"length2":33}]],"length":111777,"saved":false}
{"ts":1365247015288,"patch":[[{"diffs":[[0,"ctedCats"],[1,";"],[0,"\r\n      "]],"start1":62931,"start2":62931,"length1":16,"length2":17}]],"length":111778,"saved":false}
{"ts":1365247018114,"patch":[[{"diffs":[[0,"egories:"],[1,"sc"],[0,"});\r\n   "]],"start1":62977,"start2":62977,"length1":16,"length2":18}]],"length":111780,"saved":false}
{"ts":1365247031473,"patch":[[{"diffs":[[0,");\r\n            "],[1,"var "],[0,"link = $('#produ"]],"start1":62329,"start2":62329,"length1":32,"length2":36}]],"length":111784,"saved":false}
{"ts":1365247032980,"patch":[[{"diffs":[[0,");\r\n            "],[1,"var "],[0,"price = $('#prod"]],"start1":62383,"start2":62383,"length1":32,"length2":36}]],"length":111788,"saved":false}
{"ts":1365247034733,"patch":[[{"diffs":[[0,");\r\n            "],[1,"var "],[0,"des_en = $('#pro"]],"start1":62439,"start2":62439,"length1":32,"length2":36}]],"length":111792,"saved":false}
{"ts":1365247036088,"patch":[[{"diffs":[[0,");\r\n            "],[1,"var "],[0,"des_pl = $('#pro"]],"start1":62505,"start2":62505,"length1":32,"length2":36}]],"length":111796,"saved":false}
{"ts":1365247037341,"patch":[[{"diffs":[[0,");\r\n        "],[1,"var "],[0,"    dpl = $("]],"start1":62571,"start2":62571,"length1":24,"length2":28}]],"length":111800,"saved":false}
{"ts":1365247039666,"patch":[[{"diffs":[[0,");\r\n        "],[1,"    "],[0,"var     dpl "]],"start1":62571,"start2":62571,"length1":24,"length2":28}]],"length":111804,"saved":false}
{"ts":1365247041652,"patch":[[{"diffs":[[0,"   var  "],[-1,"   "],[0,"dpl = $("]],"start1":62584,"start2":62584,"length1":19,"length2":16}]],"length":111801,"saved":false}
{"ts":1365247042851,"patch":[[{"diffs":[[0,"    var "],[-1," "],[0,"dpl = $("]],"start1":62583,"start2":62583,"length1":17,"length2":16}]],"length":111800,"saved":false}
{"ts":1365247045074,"patch":[[{"diffs":[[0,"        "],[1,"var "],[0,"den = $("]],"start1":62642,"start2":62642,"length1":16,"length2":20}]],"length":111804,"saved":false}
{"ts":1365247047404,"patch":[[{"diffs":[[0,";;\r\n            "],[1,"var "],[0,"base64Content = "]],"start1":62698,"start2":62698,"length1":32,"length2":36}]],"length":111808,"saved":false}
{"ts":1365247048858,"patch":[[{"diffs":[[0,"            "],[1,"var "],[0,"fType = this"]],"start1":62755,"start2":62755,"length1":24,"length2":28}]],"length":111812,"saved":false}
{"ts":1365247050406,"patch":[[{"diffs":[[0,"            "],[1,"var "],[0,"fName = this"]],"start1":62792,"start2":62792,"length1":24,"length2":28}]],"length":111816,"saved":false}
{"ts":1365247052070,"patch":[[{"diffs":[[0,");\r\n            "],[1,"var "],[0,"fieldName = this"]],"start1":62844,"start2":62844,"length1":32,"length2":36}]],"length":111820,"saved":false}
{"ts":1365247059460,"patch":[[{"diffs":[[0,"his.fieldName;\r\n"],[1,"            \r\n"],[0,"            if(t"]],"start1":62877,"start2":62877,"length1":32,"length2":46}]],"length":111834,"saved":false}
{"ts":1365247069521,"patch":[[{"diffs":[[0,"\n            }\r\n"],[1,"            if(this.selectedCats.length>0)){\r\n                var sc=this.selectedCats;\r\n                newProduct.set({categories:sc});\r\n                this.modified = true;\r\n            }\r\n"],[0,"            if ("]],"start1":63084,"start2":63084,"length1":32,"length2":225}]],"length":112027,"saved":false}
{"ts":1365247076739,"patch":[[{"diffs":[[0,"if(this.selected"],[1,"Statii"],[0,"Cats.length>0)){"]],"start1":63112,"start2":63112,"length1":32,"length2":38}]],"length":112033,"saved":false}
{"ts":1365247078239,"patch":[[{"diffs":[[0,"edStatii"],[-1,"Cats"],[0,".length>"]],"start1":63126,"start2":63126,"length1":20,"length2":16}]],"length":112029,"saved":false}
{"ts":1365247086316,"patch":[[{"diffs":[[0,"sc=this.selected"],[1,"Statii"],[0,"Cats;\r\n         "]],"start1":63168,"start2":63168,"length1":32,"length2":38}]],"length":112035,"saved":false}
{"ts":1365247088920,"patch":[[{"diffs":[[0,"edStatii"],[-1,"Cats"],[0,";\r\n     "]],"start1":63182,"start2":63182,"length1":20,"length2":16}]],"length":112031,"saved":false}
{"ts":1365247091835,"patch":[[{"diffs":[[0,"           var s"],[-1,"c"],[1,"s"],[0,"=this.selectedSt"]],"start1":63153,"start2":63153,"length1":33,"length2":33}]],"length":112031,"saved":false}
{"ts":1365247096272,"patch":[[{"diffs":[[0,"et({categories:s"],[-1,"c"],[1,"s"],[0,"});\r\n           "]],"start1":63221,"start2":63221,"length1":33,"length2":33}]],"length":112031,"saved":false}
{"ts":1365247101053,"patch":[[{"diffs":[[0,"ct.set({"],[-1,"categorie"],[1,"s"],[0,"s:ss});\r"]],"start1":63217,"start2":63217,"length1":25,"length2":17}]],"length":112023,"saved":false}
{"ts":1365247102848,"patch":[[{"diffs":[[0,"ct.set({"],[1,"statu"],[0,"ss:ss});"]],"start1":63217,"start2":63217,"length1":16,"length2":21}]],"length":112028,"saved":false}
{"ts":1365247104358,"patch":[[{"diffs":[[0,"({status"],[-1,"s"],[0,":ss});\r\n"]],"start1":63223,"start2":63223,"length1":17,"length2":16}]],"length":112027,"saved":false}
{"ts":1365247126155,"patch":[[{"diffs":[[0,"edCats.length>0)"],[-1,")"],[0,"{\r\n             "]],"start1":62933,"start2":62933,"length1":33,"length2":32}]],"length":112026,"saved":false}
{"ts":1365247129134,"patch":[[{"diffs":[[0,"ength>0)"],[-1,")"],[0,"{\r\n     "]],"start1":63135,"start2":63135,"length1":17,"length2":16}]],"length":112025,"saved":false}
{"ts":1365247287857,"patch":[[{"diffs":[[0,"on.add(model);\r\n"],[1,"                        \r\n"],[0,"                "]],"start1":64847,"start2":64847,"length1":32,"length2":58}]],"length":112051,"saved":false}
{"ts":1365247291558,"patch":[[{"diffs":[[0,"                "],[1,"console."],[0,"\r\n              "]],"start1":64871,"start2":64871,"length1":32,"length2":40}]],"length":112059,"saved":false}
{"ts":1365247293782,"patch":[[{"diffs":[[0,"console."],[1,"de"],[0,"\r\n      "]],"start1":64887,"start2":64887,"length1":16,"length2":18}]],"length":112061,"saved":false}
{"ts":1365247295558,"patch":[[{"diffs":[[0,"nsole.de"],[1,"bug"],[0,"\r\n      "]],"start1":64889,"start2":64889,"length1":16,"length2":19}]],"length":112064,"saved":false}
{"ts":1365247296966,"patch":[[{"diffs":[[0,"le.debug"],[1,"()"],[0,"\r\n      "]],"start1":64892,"start2":64892,"length1":16,"length2":18}]],"length":112066,"saved":false}
{"ts":1365247299486,"patch":[[{"diffs":[[0,"e.debug("],[1,"model"],[0,")\r\n     "]],"start1":64893,"start2":64893,"length1":16,"length2":21}]],"length":112071,"saved":false}
{"ts":1365247300821,"patch":[[{"diffs":[[0,"debug(model)"],[1,";"],[0,"\r\n          "]],"start1":64895,"start2":64895,"length1":24,"length2":25}]],"length":112072,"saved":false}
{"ts":1365247350681,"patch":[[{"diffs":[[0,"to save yes/no\r\n"],[1,"            \r\n"],[0,"            tit_"]],"start1":68168,"start2":68168,"length1":32,"length2":46}]],"length":112086,"saved":false}
{"ts":1365247352163,"patch":[[{"diffs":[[0,"no\r\n            "],[1,"var sc=this.selectedCats;\r\n            var ss=this.selectedStatii;"],[0,"\r\n            ti"]],"start1":68180,"start2":68180,"length1":32,"length2":98}]],"length":112152,"saved":false}
{"ts":1365247358296,"patch":[[{"diffs":[[0,"            "],[1,"var "],[0,"tit_pl = $('"]],"start1":68264,"start2":68264,"length1":24,"length2":28}]],"length":112156,"saved":false}
{"ts":1365247361307,"patch":[[{"diffs":[[0,"        "],[1,"var "],[0,"tit_en ="]],"start1":68328,"start2":68328,"length1":16,"length2":20}]],"length":112160,"saved":false}
{"ts":1365247363775,"patch":[[{"diffs":[[0,"            "],[1,"var "],[0,"link = $('#p"]],"start1":68384,"start2":68384,"length1":24,"length2":28}]],"length":112164,"saved":false}
{"ts":1365247366129,"patch":[[{"diffs":[[0,"            "],[1,"var"],[0,"price = $('#"]],"start1":68438,"start2":68438,"length1":24,"length2":27}]],"length":112167,"saved":false}
{"ts":1365247367289,"patch":[[{"diffs":[[0,"     var"],[1," "],[0,"price = "]],"start1":68445,"start2":68445,"length1":16,"length2":17}]],"length":112168,"saved":false}
{"ts":1365247369604,"patch":[[{"diffs":[[0,"            "],[1,"var "],[0,"des_en = $('"]],"start1":68494,"start2":68494,"length1":24,"length2":28}]],"length":112172,"saved":false}
{"ts":1365247372463,"patch":[[{"diffs":[[0,"        "],[1,"var "],[0,"dpl=$('#"]],"start1":68564,"start2":68564,"length1":16,"length2":20}]],"length":112176,"saved":false}
{"ts":1365247374634,"patch":[[{"diffs":[[0,"        "],[1,"var "],[0,"den=$('#"]],"start1":68619,"start2":68619,"length1":16,"length2":20}]],"length":112180,"saved":false}
{"ts":1365247376916,"patch":[[{"diffs":[[0,"        "],[1,"var "],[0,"des_pl ="]],"start1":68674,"start2":68674,"length1":16,"length2":20}]],"length":112184,"saved":false}
{"ts":1365247379361,"patch":[[{"diffs":[[0,");\r\n            "],[1,"var "],[0,"base64Content=th"]],"start1":68732,"start2":68732,"length1":32,"length2":36}]],"length":112188,"saved":false}
{"ts":1365247381665,"patch":[[{"diffs":[[0,"            "],[1,"var "],[0,"fType=this.f"]],"start1":68787,"start2":68787,"length1":24,"length2":28}]],"length":112192,"saved":false}
{"ts":1365247383778,"patch":[[{"diffs":[[0,"            "],[1,"var "],[0,"fName=this.f"]],"start1":68822,"start2":68822,"length1":24,"length2":28}]],"length":112196,"saved":false}
{"ts":1365247397258,"patch":[[{"diffs":[[0,"es_pl !== ''"],[1,"||"],[0,") {\r\n       "]],"start1":69045,"start2":69045,"length1":24,"length2":26}]],"length":112198,"saved":false}
{"ts":1365247398870,"patch":[[{"diffs":[[0,"!== ''||"],[1,"ss"],[0,") {\r\n   "]],"start1":69051,"start2":69051,"length1":16,"length2":18}]],"length":112200,"saved":false}
{"ts":1365247400732,"patch":[[{"diffs":[[0,"= ''||ss"],[1,"."],[0,") {\r\n   "]],"start1":69053,"start2":69053,"length1":16,"length2":17}]],"length":112201,"saved":false}
{"ts":1365247402376,"patch":[[{"diffs":[[0," ''||ss."],[1,"length"],[0,") {\r\n   "]],"start1":69054,"start2":69054,"length1":16,"length2":22}]],"length":112207,"saved":false}
{"ts":1365247404881,"patch":[[{"diffs":[[0,"s.length"],[1,">0"],[0,") {\r\n   "]],"start1":69060,"start2":69060,"length1":16,"length2":18}]],"length":112209,"saved":false}
{"ts":1365247407687,"patch":[[{"diffs":[[0,"length>0"],[1,"||"],[0,") {\r\n   "]],"start1":69062,"start2":69062,"length1":16,"length2":18}]],"length":112211,"saved":false}
{"ts":1365247409635,"patch":[[{"diffs":[[0,"ngth>0||"],[1,"sc."],[0,") {\r\n   "]],"start1":69064,"start2":69064,"length1":16,"length2":19}]],"length":112214,"saved":false}
{"ts":1365247411995,"patch":[[{"diffs":[[0,"h>0||sc."],[1,"length"],[0,") {\r\n   "]],"start1":69067,"start2":69067,"length1":16,"length2":22}]],"length":112220,"saved":false}
{"ts":1365247414604,"patch":[[{"diffs":[[0,"c.length"],[1,">0"],[0,") {\r\n   "]],"start1":69073,"start2":69073,"length1":16,"length2":18}]],"length":112222,"saved":false}
{"ts":1365247479125,"patch":[[{"diffs":[[0,"s.template());\r\n"],[1,"            this.initMultiselect();\r\n"],[0,"            retu"]],"start1":62041,"start2":62041,"length1":32,"length2":69}]],"length":112259,"saved":false}
{"ts":1365247551161,"patch":[[{"diffs":[[0,"new').html());\r\n"],[1,"            \r\n"],[0,"        },\r\n    "]],"start1":61954,"start2":61954,"length1":32,"length2":46}]],"length":112273,"saved":false}
{"ts":1365247552697,"patch":[[{"diffs":[[0,");\r\n            "],[1,"this.selectedCats=[];\r\n            this.selectedStatii=[];"],[0,"\r\n        },\r\n  "]],"start1":61966,"start2":61966,"length1":32,"length2":90}]],"length":112331,"saved":false}
{"ts":1365247659830,"patch":[[{"diffs":[[0,"    "],[-1,"    var pc=this.model.toJSON().categories;\r\n            var ps=this.model.toJSON().status;"],[0,"\r\n  "]],"start1":71468,"start2":71468,"length1":98,"length2":8}]],"length":112241,"saved":false}
{"ts":1365247661339,"patch":[[{"diffs":[[0,"=this;\r\n"],[-1,"        \r\n"],[0,"        "]],"start1":71456,"start2":71456,"length1":26,"length2":16}]],"length":112231,"saved":false}
{"ts":1365247722784,"patch":[[{"diffs":[[0,"    "],[-1,"var selected=pc.indexOf(ca.category_id)!==-1?\"selected\":\"\";"],[1," "],[0,"\r\n  "]],"start1":71566,"start2":71566,"length1":67,"length2":9}]],"length":112173,"saved":false}
{"ts":1365247730891,"patch":[[{"diffs":[[0,"tegory_id+'\""],[-1,"'+selected+'"],[0,">'+ca.title_"]],"start1":71635,"start2":71635,"length1":36,"length2":24}]],"length":112161,"saved":false}
{"ts":1365247750501,"patch":[[{"diffs":[[0,"    "],[-1,"var selected=ps.indexOf(st.status_id)!==-1?\"selected\":\"\";"],[1," "],[0,"\r\n  "]],"start1":71804,"start2":71804,"length1":65,"length2":9}]],"length":112105,"saved":false}
{"ts":1365247753055,"patch":[[{"diffs":[[0,"SON();\r\n"],[-1,"                 \r\n"],[0,"        "]],"start1":71784,"start2":71784,"length1":35,"length2":16}]],"length":112086,"saved":false}
{"ts":1365247761171,"patch":[[{"diffs":[[0,"status_id+'\""],[-1,"'+selected+'"],[0,">'+st.name+'"]],"start1":71854,"start2":71854,"length1":36,"length2":24}]],"length":112074,"saved":false}
{"ts":1365247777922,"patch":[[{"diffs":[[0,"ON(); \r\n"],[-1,"                 \r\n"],[0,"        "]],"start1":71546,"start2":71546,"length1":35,"length2":16}]],"length":112055,"saved":false}
{"ts":1365248168476,"patch":[[{"diffs":[[0,"'goBack'"],[1,",\r\n            "],[0,"\r\n      "]],"start1":61663,"start2":61663,"length1":16,"length2":31}]],"length":112070,"saved":false}
{"ts":1365248170375,"patch":[[{"diffs":[[0,"',\r\n            "],[1,"'click #select-add-status':'goStatusNew',\r\n            'click #select-add-category':'goCatNew'"],[0,"\r\n            //"]],"start1":61670,"start2":61670,"length1":32,"length2":126}]],"length":112164,"saved":false}
{"ts":1365251180915,"patch":[[{"diffs":[[0,"oNewCat\""],[1,",\r\n            'keyup .search-query':'search' "],[0,"\r\n      "]],"start1":57257,"start2":57257,"length1":16,"length2":62}]],"length":112210,"saved":false}
{"ts":1365251191105,"patch":[[{"diffs":[[0,"wStatus\""],[1,",\r\n            'keyup .search-query':'search' "],[0,"\r\n      "]],"start1":59778,"start2":59778,"length1":16,"length2":62}]],"length":112256,"saved":false}
{"ts":1365251198207,"patch":[[{"diffs":[[0,"{\r\n             "],[-1," "],[0,"\"click tbody tr\""]],"start1":59684,"start2":59684,"length1":33,"length2":32}]],"length":112255,"saved":false}
{"ts":1365251199336,"patch":[[{"diffs":[[0," {\r\n            "],[-1," "],[0,"\"click tbody tr\""]],"start1":59683,"start2":59683,"length1":33,"length2":32}]],"length":112254,"saved":false}
{"ts":1365251201688,"patch":[[{"diffs":[[0,"\",\r\n            "],[-1,"  "],[0,"\"click #statii-a"]],"start1":59729,"start2":59729,"length1":34,"length2":32}]],"length":112252,"saved":false}
{"ts":1365251342579,"patch":[[{"diffs":[[0,"(mv);\r\n        }"],[1,",\r\n        renderTable:function(){\r\n            var el = this.$el; \r\n            console.debug('rendering table products');\r\n            //$('.page-sidebar').empty();//can be remove on this.class\r\n            var collection = this.collection;\r\n            var rowTemplate = this.rowTemplate;\r\n            //el.html(this.template());\r\n            el.find('tbody').html('');\r\n            collection.each(function(product){\r\n                el.find('tbody').append(rowTemplate(product.toJSON()));       \r\n                });\r\n            return this;   \r\n        },\r\n        noResults:function(){\r\n            this.$el.find('tbody').html('No results found');\r\n        },"],[0,"\r\n    });\r\n    v"]],"start1":61362,"start2":61362,"length1":32,"length2":699}]],"length":112919,"saved":false}
{"ts":1365251344228,"patch":[[{"diffs":[[0,"nd');\r\n        }"],[-1,","],[0,"\r\n    });\r\n    v"]],"start1":62028,"start2":62028,"length1":33,"length2":32}]],"length":112918,"saved":false}
{"ts":1365251352379,"patch":[[{"diffs":[[0,"n.each(function("],[-1,"produc"],[1,"sta"],[0,"t){\r\n           "]],"start1":61773,"start2":61773,"length1":38,"length2":35}]],"length":112915,"saved":false}
{"ts":1365251354037,"patch":[[{"diffs":[[0,"ion(stat"],[1,"us"],[0,"){\r\n    "]],"start1":61785,"start2":61785,"length1":16,"length2":18}]],"length":112917,"saved":false}
{"ts":1365251361883,"patch":[[{"diffs":[[0,"end(rowTemplate("],[1,"status"],[0,"product.toJSON()"]],"start1":61835,"start2":61835,"length1":32,"length2":38}]],"length":112923,"saved":false}
{"ts":1365251364837,"patch":[[{"diffs":[[0,"e(status"],[-1,"product"],[0,".toJSON("]],"start1":61849,"start2":61849,"length1":23,"length2":16}]],"length":112916,"saved":false}
{"ts":1365251378462,"patch":[[{"diffs":[[0,"emove\r\n        }"],[1,",\r\n        renderTable:function(){\r\n            var el = this.$el; \r\n            console.debug('rendering table products');\r\n            //$('.page-sidebar').empty();//can be remove on this.class\r\n            var collection = this.collection;\r\n            var rowTemplate = this.rowTemplate;\r\n            //el.html(this.template());\r\n            el.find('tbody').html('');\r\n            collection.each(function(product){\r\n                el.find('tbody').append(rowTemplate(product.toJSON()));       \r\n                });\r\n            return this;   \r\n        },\r\n        noResults:function(){\r\n            this.$el.find('tbody').html('No results found');\r\n        },"],[0,"\r\n    });//dialo"]],"start1":59040,"start2":59040,"length1":32,"length2":699}]],"length":113583,"saved":false}
{"ts":1365251382202,"patch":[[{"diffs":[[0,"nd');\r\n        }"],[-1,","],[0,"\r\n    });//dialo"]],"start1":59706,"start2":59706,"length1":33,"length2":32}]],"length":113582,"saved":false}
{"ts":1365251391911,"patch":[[{"diffs":[[0,"n.each(function("],[1,"cats"],[0,"product){\r\n     "]],"start1":59451,"start2":59451,"length1":32,"length2":36}]],"length":113586,"saved":false}
{"ts":1365251394239,"patch":[[{"diffs":[[0,"ion(cats"],[-1,"product"],[0,"){\r\n    "]],"start1":59463,"start2":59463,"length1":23,"length2":16}]],"length":113579,"saved":false}
{"ts":1365251399160,"patch":[[{"diffs":[[0,"tion(cat"],[-1,"s"],[0,"){\r\n    "]],"start1":59462,"start2":59462,"length1":17,"length2":16}]],"length":113578,"saved":false}
{"ts":1365251404287,"patch":[[{"diffs":[[0,"end(rowTemplate("],[-1,"produ"],[0,"ct.toJSON()));  "]],"start1":59510,"start2":59510,"length1":37,"length2":32}]],"length":113573,"saved":false}
{"ts":1365251405925,"patch":[[{"diffs":[[0,"mplate(c"],[1,"a"],[0,"t.toJSON"]],"start1":59519,"start2":59519,"length1":16,"length2":17}]],"length":113574,"saved":false}
{"ts":1365251514080,"patch":[[{"diffs":[[0,"rendering table "],[-1,"produ"],[0,"c"],[1,"a"],[0,"ts');\r\n         "]],"start1":59152,"start2":59152,"length1":38,"length2":34}]],"length":113570,"saved":false}
{"ts":1365251528131,"patch":[[{"diffs":[[0,"ering table "],[-1,"products"],[1,"statii"],[0,"');\r\n       "]],"start1":62132,"start2":62132,"length1":32,"length2":30}]],"length":113568,"saved":false}
{"ts":1365251575458,"patch":[[{"diffs":[[0,"sults found');\r\n"],[1,"        } search:function(){\r\n            //maybe strip preceeding whitespaces\r\n            \r\n            var sq=$('.search-query').val().toLocaleLowerCase().trim();\r\n            console.debug('searching for:'+sq+':are we?');\r\n            if(sq!==''){ \r\n               var searchCollection = new Products();\r\n                products.each(function(product){\r\n                  var  p=product.toJSON();\r\n                    if (p.title_en &&p.title_en.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product);\r\n                    } \r\n                    else if (p.title_pl&&p.title_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product); \r\n                    }    \r\n                    else if (p.description_en&&p.description_en.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product);\r\n                    }\r\n                    else if (p.description_pl&&p.description_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product);\r\n                    } \r\n                });\r\n                console.debug(searchCollection.toJSON());\r\n                if(searchCollection.length!==0){\r\n                   this.collection=searchCollection; \r\n                   this.renderTable();\r\n                }\r\n                else{\r\n                    this.noResults();\r\n                }\r\n            }\r\n            else{\r\n                this.collection=products;\r\n                this.renderTable();\r\n            }\r\n//            console.debug('searching for:'+sq+':are we?');\r\n"],[0,"        }\r\n    }"]],"start1":59685,"start2":59685,"length1":32,"length2":1666}]],"length":115202,"saved":false}
{"ts":1365251594326,"patch":[[{"diffs":[[0,"       }"],[1,",\r\n       "],[0," search:"]],"start1":59702,"start2":59702,"length1":16,"length2":26}]],"length":115212,"saved":false}
{"ts":1365251639682,"patch":[[{"diffs":[[0,"ollection = new "],[1,"Ca"],[0,"Products();\r\n   "]],"start1":59991,"start2":59991,"length1":32,"length2":34}]],"length":115214,"saved":false}
{"ts":1365251640836,"patch":[[{"diffs":[[0,"= new Ca"],[1,"t"],[0,"Products"]],"start1":60001,"start2":60001,"length1":16,"length2":17}]],"length":115215,"saved":false}
{"ts":1365251644243,"patch":[[{"diffs":[[0," new Cat"],[-1,"Product"],[0,"s();\r\n  "]],"start1":60002,"start2":60002,"length1":23,"length2":16}]],"length":115208,"saved":false}
{"ts":1365251655083,"patch":[[{"diffs":[[0,"                "],[-1,"produc"],[1,"cat"],[0,"ts.each(function"]],"start1":60016,"start2":60016,"length1":38,"length2":35}]],"length":115205,"saved":false}
{"ts":1365251657855,"patch":[[{"diffs":[[0,"     cat"],[-1,"t"],[0,"s.each(f"]],"start1":60027,"start2":60027,"length1":17,"length2":16}]],"length":115204,"saved":false}
{"ts":1365251662160,"patch":[[{"diffs":[[0,"s.each(function("],[1,"ca"],[0,"product){\r\n     "]],"start1":60035,"start2":60035,"length1":32,"length2":34}]],"length":115206,"saved":false}
{"ts":1365251664790,"patch":[[{"diffs":[[0,"ction(ca"],[-1,"produc"],[0,"t){\r\n   "]],"start1":60045,"start2":60045,"length1":22,"length2":16}]],"length":115200,"saved":false}
{"ts":1365251669247,"patch":[[{"diffs":[[0,"           var  "],[-1,"p"],[1,"c"],[0,"=product.toJSON("]],"start1":60065,"start2":60065,"length1":33,"length2":33}]],"length":115200,"saved":false}
{"ts":1365251674052,"patch":[[{"diffs":[[0," var  c="],[-1,"produ"],[0,"ct.toJSO"]],"start1":60075,"start2":60075,"length1":21,"length2":16}]],"length":115195,"saved":false}
{"ts":1365251676172,"patch":[[{"diffs":[[0,"var  c=c"],[1,"a"],[0,"t.toJSON"]],"start1":60076,"start2":60076,"length1":16,"length2":17}]],"length":115196,"saved":false}
{"ts":1365251703731,"patch":[[{"diffs":[[0,"            if ("],[-1,"p"],[1,"c"],[0,".title_en &&p.ti"]],"start1":60106,"start2":60106,"length1":33,"length2":33}]],"length":115196,"saved":false}
{"ts":1365251707381,"patch":[[{"diffs":[[0," if (c.title"],[-1,"_en"],[0," &&p.title_e"]],"start1":60117,"start2":60117,"length1":27,"length2":24}]],"length":115193,"saved":false}
{"ts":1365251715746,"patch":[[{"diffs":[[0,".title &&p.title"],[-1,"_en"],[0,".toLocaleLowerCa"]],"start1":60123,"start2":60123,"length1":35,"length2":32}]],"length":115190,"saved":false}
{"ts":1365251724322,"patch":[[{"diffs":[[0,"hCollection.add("],[-1,"produ"],[0,"ct);\r\n          "]],"start1":60210,"start2":60210,"length1":37,"length2":32}]],"length":115185,"saved":false}
{"ts":1365251726159,"patch":[[{"diffs":[[0,"on.add(c"],[1,"a"],[0,"t);\r\n   "]],"start1":60219,"start2":60219,"length1":16,"length2":17}]],"length":115186,"saved":false}
{"ts":1365251744574,"patch":[[{"diffs":[[0,"    "],[-1,"    else if (p.title_pl&&p.title_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product); \r\n                    }    "],[0,"\r\n  "]],"start1":60269,"start2":60269,"length1":167,"length2":8}]],"length":115027,"saved":false}
{"ts":1365251746985,"patch":[[{"diffs":[[0,"    } \r\n"],[-1,"                \r\n"],[0,"        "]],"start1":60249,"start2":60249,"length1":34,"length2":16}]],"length":115009,"saved":false}
{"ts":1365251751364,"patch":[[{"diffs":[[0,"f (p.description"],[-1,"_en"],[0,"&&p.description_"]],"start1":60283,"start2":60283,"length1":35,"length2":32}]],"length":115006,"saved":false}
{"ts":1365251756601,"patch":[[{"diffs":[[0,"n&&p.description"],[-1,"_en"],[0,".toLocaleLowerCa"]],"start1":60298,"start2":60298,"length1":35,"length2":32}]],"length":115003,"saved":false}
{"ts":1365251762440,"patch":[[{"diffs":[[0,"       else if ("],[-1,"p"],[1,"c"],[0,".description&&p."]],"start1":60270,"start2":60270,"length1":33,"length2":33}]],"length":115003,"saved":false}
{"ts":1365251765242,"patch":[[{"diffs":[[0,"iption&&"],[-1,"p"],[1,"c"],[0,".descrip"]],"start1":60293,"start2":60293,"length1":17,"length2":17}]],"length":115003,"saved":false}
{"ts":1365251769791,"patch":[[{"diffs":[[0,"hCollection.add("],[-1,"produ"],[0,"ct);\r\n          "]],"start1":60385,"start2":60385,"length1":37,"length2":32}]],"length":114998,"saved":false}
{"ts":1365251771241,"patch":[[{"diffs":[[0,"on.add(c"],[1,"a"],[0,"t);\r\n   "]],"start1":60394,"start2":60394,"length1":16,"length2":17}]],"length":114999,"saved":false}
{"ts":1365251783628,"patch":[[{"diffs":[[0,"    "],[-1,"else if (p.description_pl&&p.description_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product);\r\n                    }"],[0," \r\n "]],"start1":60447,"start2":60447,"length1":170,"length2":8}]],"length":114837,"saved":false}
{"ts":1365251786633,"patch":[[{"diffs":[[0,"     }\r\n"],[-1,"                     \r\n"],[0,"        "]],"start1":60423,"start2":60423,"length1":39,"length2":16}]],"length":114814,"saved":false}
{"ts":1365251816774,"patch":[[{"diffs":[[0,"  if (c."],[-1,"t"],[1,"name"],[0,"itle &&p"]],"start1":60116,"start2":60116,"length1":17,"length2":20}]],"length":114817,"saved":false}
{"ts":1365251818273,"patch":[[{"diffs":[[0," (c.name"],[-1,"itle"],[0," &&p.tit"]],"start1":60120,"start2":60120,"length1":20,"length2":16}]],"length":114813,"saved":false}
{"ts":1365251822766,"patch":[[{"diffs":[[0,"(c.name &&p."],[1,"n"],[0,"title.toLoca"]],"start1":60121,"start2":60121,"length1":24,"length2":25}]],"length":114814,"saved":false}
{"ts":1365251823885,"patch":[[{"diffs":[[0,"me &&p.n"],[1,"a"],[0,"title.to"]],"start1":60126,"start2":60126,"length1":16,"length2":17}]],"length":114815,"saved":false}
{"ts":1365251825146,"patch":[[{"diffs":[[0,"e &&p.na"],[-1,"t"],[1,"me"],[0,"itle.toL"]],"start1":60127,"start2":60127,"length1":17,"length2":18}]],"length":114816,"saved":false}
{"ts":1365251827116,"patch":[[{"diffs":[[0,"&&p.name"],[-1,"itl"],[0,"e.toLoca"]],"start1":60129,"start2":60129,"length1":19,"length2":16}]],"length":114813,"saved":false}
{"ts":1365251828379,"patch":[[{"diffs":[[0,"&&p.name"],[-1,"e"],[0,".toLocal"]],"start1":60129,"start2":60129,"length1":17,"length2":16}]],"length":114812,"saved":false}
{"ts":1365251834525,"patch":[[{"diffs":[[0,".name &&"],[-1,"p"],[1,"c"],[0,".name.to"]],"start1":60123,"start2":60123,"length1":17,"length2":17}]],"length":114812,"saved":false}
{"ts":1365251994875,"patch":[[{"diffs":[[0,".name &&"],[-1,"c"],[1,"p"],[0,".name"],[1,"itle"],[0,".toLocal"]],"start1":60123,"start2":60123,"length1":22,"length2":26}]],"length":114816,"saved":false}
{"ts":1365251999284,"patch":[[{"diffs":[[0," (c."],[-1,"nam"],[1,"titl"],[0,"e &&p."],[-1,"name"],[1,"t"],[0,"itle"]],"start1":60120,"start2":60120,"length1":21,"length2":19}]],"length":114814,"saved":false}
{"ts":1365252003367,"patch":[[{"diffs":[[0,"(c.title"],[1,"_en"],[0," &&p.tit"]],"start1":60121,"start2":60121,"length1":16,"length2":19}]],"length":114817,"saved":false}
{"ts":1365252006444,"patch":[[{"diffs":[[0,".title_en &&"],[-1,"p"],[1,"c"],[0,".title.toLoc"]],"start1":60123,"start2":60123,"length1":25,"length2":25}]],"length":114817,"saved":false}
{"ts":1365252010171,"patch":[[{"diffs":[[0,"&c.title"],[1,"_en"],[0,".toLocal"]],"start1":60134,"start2":60134,"length1":16,"length2":19}]],"length":114820,"saved":false}
{"ts":1365252018840,"patch":[[{"diffs":[[0,"e if (c."],[1,"title"],[0,"descript"]],"start1":60286,"start2":60286,"length1":16,"length2":21}]],"length":114825,"saved":false}
{"ts":1365252020261,"patch":[[{"diffs":[[0,"(c.title"],[1,"_pl"],[0,"descript"]],"start1":60291,"start2":60291,"length1":16,"length2":19}]],"length":114828,"saved":false}
{"ts":1365252023150,"patch":[[{"diffs":[[0,"title_pl"],[-1,"descr"],[0,"iption&&"]],"start1":60294,"start2":60294,"length1":21,"length2":16}]],"length":114823,"saved":false}
{"ts":1365252027648,"patch":[[{"diffs":[[0,"title_pl"],[-1,"iptio"],[0,"n&&c.des"]],"start1":60294,"start2":60294,"length1":21,"length2":16}]],"length":114818,"saved":false}
{"ts":1365252029403,"patch":[[{"diffs":[[0,"title_pl"],[-1,"n"],[0,"&&c.desc"]],"start1":60294,"start2":60294,"length1":17,"length2":16}]],"length":114817,"saved":false}
{"ts":1365252033718,"patch":[[{"diffs":[[0,"e_pl&&c."],[1,"title"],[0,"descript"]],"start1":60298,"start2":60298,"length1":16,"length2":21}]],"length":114822,"saved":false}
{"ts":1365252035439,"patch":[[{"diffs":[[0,"&c.title"],[1,"_"],[0,"descript"]],"start1":60303,"start2":60303,"length1":16,"length2":17}]],"length":114823,"saved":false}
{"ts":1365252037466,"patch":[[{"diffs":[[0,"c.title_"],[-1,"des"],[1,"pl"],[0,"cription"]],"start1":60304,"start2":60304,"length1":19,"length2":18}]],"length":114822,"saved":false}
{"ts":1365252039988,"patch":[[{"diffs":[[0,"title_pl"],[-1,"cription"],[0,".toLocal"]],"start1":60306,"start2":60306,"length1":24,"length2":16}]],"length":114814,"saved":false}
{"ts":1365252063098,"patch":[[{"diffs":[[0,"sults found');\r\n"],[1,"        } search:function(){\r\n            //maybe strip preceeding whitespaces\r\n            \r\n            var sq=$('.search-query').val().toLocaleLowerCase().trim();\r\n            console.debug('searching for:'+sq+':are we?');\r\n            if(sq!==''){ \r\n               var searchCollection = new Cats();\r\n                cats.each(function(cat){\r\n                  var  c=cat.toJSON();\r\n                    if (c.title_en &&c.title_en.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(cat);\r\n                    } \r\n                    else if (c.title_pl&&c.title_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(cat);\r\n                    }\r\n                });\r\n                console.debug(searchCollection.toJSON());\r\n                if(searchCollection.length!==0){\r\n                   this.collection=searchCollection; \r\n                   this.renderTable();\r\n                }\r\n                else{\r\n                    this.noResults();\r\n                }\r\n            }\r\n            else{\r\n                this.collection=products;\r\n                this.renderTable();\r\n            }\r\n//            console.debug('searching for:'+sq+':are we?');\r\n"],[0,"        }\r\n    }"]],"start1":63915,"start2":63915,"length1":32,"length2":1268}]],"length":116050,"saved":false}
{"ts":1365252067722,"patch":[[{"diffs":[[0,"       }"],[1,",\r\n       "],[0," search:"]],"start1":63932,"start2":63932,"length1":16,"length2":26}]],"length":116060,"saved":false}
{"ts":1365252073891,"patch":[[{"diffs":[[0,"ollection = new "],[1,"Stat"],[0,"Cats();\r\n       "]],"start1":64221,"start2":64221,"length1":32,"length2":36}]],"length":116064,"saved":false}
{"ts":1365252075526,"patch":[[{"diffs":[[0,"new Stat"],[1,"ii"],[0,"Cats();\r"]],"start1":64233,"start2":64233,"length1":16,"length2":18}]],"length":116066,"saved":false}
{"ts":1365252078231,"patch":[[{"diffs":[[0,"w Statii"],[-1,"Cats"],[0,"();\r\n   "]],"start1":64235,"start2":64235,"length1":20,"length2":16}]],"length":116062,"saved":false}
{"ts":1365252136579,"patch":[[{"diffs":[[0,"                "],[-1,"cat"],[0,"s.each(function("]],"start1":64248,"start2":64248,"length1":35,"length2":32}]],"length":116059,"saved":false}
{"ts":1365252140043,"patch":[[{"diffs":[[0,"       s"],[1,"t"],[0,".each(fu"]],"start1":64257,"start2":64257,"length1":16,"length2":17}]],"length":116060,"saved":false}
{"ts":1365252141563,"patch":[[{"diffs":[[0,"      st"],[1,"atii"],[0,".each(fu"]],"start1":64258,"start2":64258,"length1":16,"length2":20}]],"length":116064,"saved":false}
{"ts":1365252205062,"patch":[[{"diffs":[[0,"i.each(function("],[1,"status"],[0,"cat){\r\n         "]],"start1":64269,"start2":64269,"length1":32,"length2":38}]],"length":116070,"saved":false}
{"ts":1365252207032,"patch":[[{"diffs":[[0,"n(status"],[-1,"cat"],[0,"){\r\n    "]],"start1":64283,"start2":64283,"length1":19,"length2":16}]],"length":116067,"saved":false}
{"ts":1365252211991,"patch":[[{"diffs":[[0,"         var  c="],[1,"status"],[0,"cat.toJSON();\r\n "]],"start1":64304,"start2":64304,"length1":32,"length2":38}]],"length":116073,"saved":false}
{"ts":1365252214606,"patch":[[{"diffs":[[0,"c=status"],[-1,"cat"],[0,".toJSON("]],"start1":64318,"start2":64318,"length1":19,"length2":16}]],"length":116070,"saved":false}
{"ts":1365252217869,"patch":[[{"diffs":[[0,"   var  "],[-1,"c"],[1,"s"],[0,"=status."]],"start1":64310,"start2":64310,"length1":17,"length2":17}]],"length":116070,"saved":false}
{"ts":1365252223517,"patch":[[{"diffs":[[0,"     if (c.title"],[-1,"_en"],[0," &&c.title_en.to"]],"start1":64353,"start2":64353,"length1":35,"length2":32}]],"length":116067,"saved":false}
{"ts":1365252227616,"patch":[[{"diffs":[[0,".title &&c.title"],[-1,"_en"],[0,".toLocaleLowerCa"]],"start1":64363,"start2":64363,"length1":35,"length2":32}]],"length":116064,"saved":false}
{"ts":1365252237071,"patch":[[{"diffs":[[0,"hCollection.add("],[1,"status"],[0,"cat);\r\n         "]],"start1":64450,"start2":64450,"length1":32,"length2":38}]],"length":116070,"saved":false}
{"ts":1365252239625,"patch":[[{"diffs":[[0,"d(status"],[-1,"cat"],[0,");\r\n    "]],"start1":64464,"start2":64464,"length1":19,"length2":16}]],"length":116067,"saved":false}
{"ts":1365252245645,"patch":[[{"diffs":[[0,"hCollection.add("],[1,"sttu"],[0,"cat);\r\n         "]],"start1":64622,"start2":64622,"length1":32,"length2":36}]],"length":116071,"saved":false}
{"ts":1365252246889,"patch":[[{"diffs":[[0,"add(sttu"],[1,"s"],[0,"cat);\r\n "]],"start1":64634,"start2":64634,"length1":16,"length2":17}]],"length":116072,"saved":false}
{"ts":1365252252629,"patch":[[{"diffs":[[0,"n.add(st"],[1,"a"],[0,"tuscat);"]],"start1":64632,"start2":64632,"length1":16,"length2":17}]],"length":116073,"saved":false}
{"ts":1365252255922,"patch":[[{"diffs":[[0,"d(status"],[-1,"cat"],[0,");\r\n    "]],"start1":64636,"start2":64636,"length1":19,"length2":16}]],"length":116070,"saved":false}
{"ts":1365252260884,"patch":[[{"diffs":[[0,"     else if (c."],[1,"descri"],[0,"title_pl&&c.titl"]],"start1":64515,"start2":64515,"length1":32,"length2":38}]],"length":116076,"saved":false}
{"ts":1365252261806,"patch":[[{"diffs":[[0,"c.descri"],[1,"pt"],[0,"title_pl"]],"start1":64529,"start2":64529,"length1":16,"length2":18}]],"length":116078,"saved":false}
{"ts":1365252263449,"patch":[[{"diffs":[[0,"descript"],[1,"ion"],[0,"title_pl"]],"start1":64531,"start2":64531,"length1":16,"length2":19}]],"length":116081,"saved":false}
{"ts":1365252266582,"patch":[[{"diffs":[[0,"cription"],[-1,"title_pl"],[0,"&&c.titl"]],"start1":64534,"start2":64534,"length1":24,"length2":16}]],"length":116073,"saved":false}
{"ts":1365252271679,"patch":[[{"diffs":[[0,"cription&&c."],[1,"descri"],[0,"title_pl.toL"]],"start1":64534,"start2":64534,"length1":24,"length2":30}]],"length":116079,"saved":false}
{"ts":1365252272999,"patch":[[{"diffs":[[0,"c.descri"],[1,"pi"],[0,"title_pl"]],"start1":64544,"start2":64544,"length1":16,"length2":18}]],"length":116081,"saved":false}
{"ts":1365252274403,"patch":[[{"diffs":[[0,"descripi"],[1,"on"],[0,"title_pl"]],"start1":64546,"start2":64546,"length1":16,"length2":18}]],"length":116083,"saved":false}
{"ts":1365252277077,"patch":[[{"diffs":[[0,".descrip"],[1,"t"],[0,"iontitle"]],"start1":64545,"start2":64545,"length1":16,"length2":17}]],"length":116084,"saved":false}
{"ts":1365252281392,"patch":[[{"diffs":[[0,"cription"],[-1,"title_pl"],[0,".toLocal"]],"start1":64549,"start2":64549,"length1":24,"length2":16}]],"length":116076,"saved":false}
{"ts":1365252289514,"patch":[[{"diffs":[[0,"lse if ("],[-1,"c"],[1,"s"],[0,".descrip"]],"start1":64521,"start2":64521,"length1":17,"length2":17}]],"length":116076,"saved":false}
{"ts":1365252297754,"patch":[[{"diffs":[[0,"iption&&"],[-1,"c"],[1,"s"],[0,".descrip"]],"start1":64536,"start2":64536,"length1":17,"length2":17}]],"length":116076,"saved":false}
{"ts":1365252303645,"patch":[[{"diffs":[[0,"title &&"],[-1,"c"],[0,".title.t"]],"start1":64364,"start2":64364,"length1":17,"length2":16}]],"length":116075,"saved":false}
{"ts":1365252305166,"patch":[[{"diffs":[[0,"title &&"],[1,"s"],[0,".title.t"]],"start1":64364,"start2":64364,"length1":16,"length2":17}]],"length":116076,"saved":false}
{"ts":1365252307316,"patch":[[{"diffs":[[0,"        if ("],[-1,"c"],[1,"s"],[0,".title &&s.t"]],"start1":64350,"start2":64350,"length1":25,"length2":25}]],"length":116076,"saved":false}
{"contributors":[],"silentsave":true,"ts":1365252793991,"patch":[[{"diffs":[[1,"//author= blackmwana\r\n//deleted categories should be cattered for , maybe a clean up function after a cat is deleted, custom code\r\nBackbone.View.prototype.close = function() {\r\n        //http://lostechies.com/derickbailey/2011/09/15/zombies-run-managing-page-transitions-in-backbone-apps/\r\n        console.log(this.el.localName);\r\n        console.log(this);\r\n        if (this.el.tagName.toLowerCase() === 'body') {\r\n            $('body').empty();\r\n            console.debug('emptying body');\r\n        }\r\n        else {\r\n            this.remove(); //el.remove\r\n            console.debug(this.el + ': removing view  el');\r\n        }\r\n        this.unbind();\r\n        if (this.onClose) {//have to implement these to unbind model bindings\r\n            this.onClose();\r\n        }\r\n    }\r\n    //////////////////\r\nfunction get_gravatar(email, size) {\r\n\r\n        // MD5 (Message-Digest Algorithm) by WebToolkit\r\n        // \r\n         \r\n        var MD5 = function(s) {\r\n            function L(k, d) {\r\n                return (k << d) | (k >>> (32 - d))\r\n            }\r\n            function K(G, k) {\r\n                var I, d, F, H, x;\r\n                F = (G & 2147483648);\r\n                H = (k & 2147483648);\r\n                I = (G & 1073741824);\r\n                d = (k & 1073741824);\r\n                x = (G & 1073741823) + (k & 1073741823);\r\n                if (I & d) {\r\n                    return (x ^ 2147483648 ^ F ^ H)\r\n                }\r\n                if (I | d) {\r\n                    if (x & 1073741824) {\r\n                        return (x ^ 3221225472 ^ F ^ H)\r\n                    }\r\n                    else {\r\n                        return (x ^ 1073741824 ^ F ^ H)\r\n                    }\r\n                }\r\n                else {\r\n                    return (x ^ F ^ H)\r\n                }\r\n            }\r\n            function r(d, F, k) {\r\n                return (d & F) | ((~d) & k)\r\n            }\r\n            function q(d, F, k) {\r\n                return (d & k) | (F & (~k))\r\n            }\r\n            function p(d, F, k) {\r\n                return (d ^ F ^ k)\r\n            }\r\n            function n(d, F, k) {\r\n                return (F ^ (d | (~k)))\r\n            }\r\n            function u(G, F, aa, Z, k, H, I) {\r\n                G = K(G, K(K(r(F, aa, Z), k), I));\r\n                return K(L(G, H), F)\r\n            }\r\n            function f(G, F, aa, Z, k, H, I) {\r\n                G = K(G, K(K(q(F, aa, Z), k), I));\r\n                return K(L(G, H), F)\r\n            }\r\n            function D(G, F, aa, Z, k, H, I) {\r\n                G = K(G, K(K(p(F, aa, Z), k), I));\r\n                return K(L(G, H), F)\r\n            }\r\n            function t(G, F, aa, Z, k, H, I) {\r\n                G = K(G, K(K(n(F, aa, Z), k), I));\r\n                return K(L(G, H), F)\r\n            }\r\n            function e(G) {\r\n                var Z;\r\n                var F = G.length;\r\n                var x = F + 8;\r\n                var k = (x - (x % 64)) / 64;\r\n                var I = (k + 1) * 16;\r\n                var aa = Array(I - 1);\r\n                var d = 0;\r\n                var H = 0;\r\n                while (H < F) {\r\n                    Z = (H - (H % 4)) / 4;\r\n                    d = (H % 4) * 8;\r\n                    aa[Z] = (aa[Z] | (G.charCodeAt(H) << d));\r\n                    H++\r\n                }\r\n                Z = (H - (H % 4)) / 4;\r\n                d = (H % 4) * 8;\r\n                aa[Z] = aa[Z] | (128 << d);\r\n                aa[I - 2] = F << 3;\r\n                aa[I - 1] = F >>> 29;\r\n                return aa\r\n            }\r\n            function B(x) {\r\n                var k = \"\",\r\n                    F = \"\",\r\n                    G, d;\r\n                for (d = 0; d <= 3; d++) {\r\n                    G = (x >>> (d * 8)) & 255;\r\n                    F = \"0\" + G.toString(16);\r\n                    k = k + F.substr(F.length - 2, 2)\r\n                }\r\n                return k\r\n            }\r\n            function J(k) {\r\n                k = k.replace(/rn/g, \"n\");\r\n                var d = \"\";\r\n                for (var F = 0; F < k.length; F++) {\r\n                    var x = k.charCodeAt(F);\r\n                    if (x < 128) {\r\n                        d += String.fromCharCode(x)\r\n                    }\r\n                    else {\r\n                        if ((x > 127) && (x < 2048)) {\r\n                            d += String.fromCharCode((x >> 6) | 192);\r\n                            d += String.fromCharCode((x & 63) | 128)\r\n                        }\r\n                        else {\r\n                            d += String.fromCharCode((x >> 12) | 224);\r\n                            d += String.fromCharCode(((x >> 6) & 63) | 128);\r\n                            d += String.fromCharCode((x & 63) | 128)\r\n                        }\r\n                    }\r\n                }\r\n                return d\r\n            }\r\n            var C = Array();\r\n            var P, h, E, v, g, Y, X, W, V;\r\n            var S = 7,\r\n                Q = 12,\r\n                N = 17,\r\n                M = 22;\r\n            var A = 5,\r\n                z = 9,\r\n                y = 14,\r\n                w = 20;\r\n            var o = 4,\r\n                m = 11,\r\n                l = 16,\r\n                j = 23;\r\n            var U = 6,\r\n                T = 10,\r\n                R = 15,\r\n                O = 21;\r\n            s = J(s);\r\n            C = e(s);\r\n            Y = 1732584193;\r\n            X = 4023233417;\r\n            W = 2562383102;\r\n            V = 271733878;\r\n            for (P = 0; P < C.length; P += 16) {\r\n                h = Y;\r\n                E = X;\r\n                v = W;\r\n                g = V;\r\n                Y = u(Y, X, W, V, C[P + 0], S, 3614090360);\r\n                V = u(V, Y, X, W, C[P + 1], Q, 3905402710);\r\n                W = u(W, V, Y, X, C[P + 2], N, 606105819);\r\n                X = u(X, W, V, Y, C[P + 3], M, 3250441966);\r\n                Y = u(Y, X, W, V, C[P + 4], S, 4118548399);\r\n                V = u(V, Y, X, W, C[P + 5], Q, 1200080426);\r\n                W = u(W, V, Y, X, C[P + 6], N, 2821735955);\r\n                X = u(X, W, V, Y, C[P + 7], M, 4249261313);\r\n                Y = u(Y, X, W, V, C[P + 8], S, 1770035416);\r\n                V = u(V, Y, X, W, C[P + 9], Q, 2336552879);\r\n                W = u(W, V, Y, X, C[P + 10], N, 4294925233);\r\n                X = u(X, W, V, Y, C[P + 11], M, 2304563134);\r\n                Y = u(Y, X, W, V, C[P + 12], S, 1804603682);\r\n                V = u(V, Y, X, W, C[P + 13], Q, 4254626195);\r\n                W = u(W, V, Y, X, C[P + 14], N, 2792965006);\r\n                X = u(X, W, V, Y, C[P + 15], M, 1236535329);\r\n                Y = f(Y, X, W, V, C[P + 1], A, 4129170786);\r\n                V = f(V, Y, X, W, C[P + 6], z, 3225465664);\r\n                W = f(W, V, Y, X, C[P + 11], y, 643717713);\r\n                X = f(X, W, V, Y, C[P + 0], w, 3921069994);\r\n                Y = f(Y, X, W, V, C[P + 5], A, 3593408605);\r\n                V = f(V, Y, X, W, C[P + 10], z, 38016083);\r\n                W = f(W, V, Y, X, C[P + 15], y, 3634488961);\r\n                X = f(X, W, V, Y, C[P + 4], w, 3889429448);\r\n                Y = f(Y, X, W, V, C[P + 9], A, 568446438);\r\n                V = f(V, Y, X, W, C[P + 14], z, 3275163606);\r\n                W = f(W, V, Y, X, C[P + 3], y, 4107603335);\r\n                X = f(X, W, V, Y, C[P + 8], w, 1163531501);\r\n                Y = f(Y, X, W, V, C[P + 13], A, 2850285829);\r\n                V = f(V, Y, X, W, C[P + 2], z, 4243563512);\r\n                W = f(W, V, Y, X, C[P + 7], y, 1735328473);\r\n                X = f(X, W, V, Y, C[P + 12], w, 2368359562);\r\n                Y = D(Y, X, W, V, C[P + 5], o, 4294588738);\r\n                V = D(V, Y, X, W, C[P + 8], m, 2272392833);\r\n                W = D(W, V, Y, X, C[P + 11], l, 1839030562);\r\n                X = D(X, W, V, Y, C[P + 14], j, 4259657740);\r\n                Y = D(Y, X, W, V, C[P + 1], o, 2763975236);\r\n                V = D(V, Y, X, W, C[P + 4], m, 1272893353);\r\n                W = D(W, V, Y, X, C[P + 7], l, 4139469664);\r\n                X = D(X, W, V, Y, C[P + 10], j, 3200236656);\r\n                Y = D(Y, X, W, V, C[P + 13], o, 681279174);\r\n                V = D(V, Y, X, W, C[P + 0], m, 3936430074);\r\n                W = D(W, V, Y, X, C[P + 3], l, 3572445317);\r\n                X = D(X, W, V, Y, C[P + 6], j, 76029189);\r\n                Y = D(Y, X, W, V, C[P + 9], o, 3654602809);\r\n                V = D(V, Y, X, W, C[P + 12], m, 3873151461);\r\n                W = D(W, V, Y, X, C[P + 15], l, 530742520);\r\n                X = D(X, W, V, Y, C[P + 2], j, 3299628645);\r\n                Y = t(Y, X, W, V, C[P + 0], U, 4096336452);\r\n                V = t(V, Y, X, W, C[P + 7], T, 1126891415);\r\n                W = t(W, V, Y, X, C[P + 14], R, 2878612391);\r\n                X = t(X, W, V, Y, C[P + 5], O, 4237533241);\r\n                Y = t(Y, X, W, V, C[P + 12], U, 1700485571);\r\n                V = t(V, Y, X, W, C[P + 3], T, 2399980690);\r\n                W = t(W, V, Y, X, C[P + 10], R, 4293915773);\r\n                X = t(X, W, V, Y, C[P + 1], O, 2240044497);\r\n                Y = t(Y, X, W, V, C[P + 8], U, 1873313359);\r\n                V = t(V, Y, X, W, C[P + 15], T, 4264355552);\r\n                W = t(W, V, Y, X, C[P + 6], R, 2734768916);\r\n                X = t(X, W, V, Y, C[P + 13], O, 1309151649);\r\n                Y = t(Y, X, W, V, C[P + 4], U, 4149444226);\r\n                V = t(V, Y, X, W, C[P + 11], T, 3174756917);\r\n                W = t(W, V, Y, X, C[P + 2], R, 718787259);\r\n                X = t(X, W, V, Y, C[P + 9], O, 3951481745);\r\n                Y = K(Y, h);\r\n                X = K(X, E);\r\n                W = K(W, v);\r\n                V = K(V, g)\r\n            }\r\n            var i = B(Y) + B(X) + B(W) + B(V);\r\n            return i.toLowerCase()\r\n          \r\n        };\r\n\r\n        var size = size || 80;\r\n        var d ='wavatar';\r\n\r\n        return 'http://www.gravatar.com/avatar/' + MD5(email) + '.jpg?s=' + size+'&d='+d;\r\n    }\r\nif (!String.prototype.trim) {\r\n String.prototype.trim = function() {\r\n  return this.replace(/^\\s+|\\s+$/g,'');\r\n }\r\n}\r\nfunction arraysEqual(array1,array2){\r\n    if(!$.isArray(array1) || !$.isArray(array2))\r\n        return false;\r\n    //check if lengths are different\r\n    if(array1.length !== array2.length) \r\n        return false;    \r\n    //slice so we do not effect the original\r\n    //sort makes sure they are in order\r\n    //join makes it a string so we can do a string compare\r\n    var cA = array1.slice().sort().join(\",\"); \r\n    var cB = array2.slice().sort().join(\",\");\r\n\r\n    return cA===cB;\r\n}\r\n\r\n$(document).ready(function() {\r\n    \r\n    var admin;\r\n    var mainView;\r\n    var cats;\r\n    var statii\r\n    var products;\r\n    var curProd;\r\n\r\n    var Cat = StackMob.Model.extend({\r\n        schemaName:'category',\r\n        defaults:function(){\r\n            return{\r\n                title_en:'not set',\r\n                title_pl:'not set',\r\n                count:0\r\n            }\r\n        }\r\n    });\r\n    var Cats = StackMob.Collection.extend({\r\n        model:Cat\r\n    });\r\n    var Status = StackMob.Model.extend({\r\n        schemaName:\"status\",\r\n        defaults:function(){\r\n            return{\r\n                name:'not set',\r\n                description:'not set',\r\n                count:0\r\n            }\r\n        }\r\n    })\r\n    var Statii = StackMob.Collection.extend({\r\n        model:Status\r\n    });\r\n    //var Profile = StackMob.Model.extend({ binaryFields: ['pic', 'largepic'] }); \r\n    var Product = StackMob.Model.extend({       \r\n        schemaName:\"product\",\r\n       // binaryFields:['picture'],\r\n        defaults:function(){\r\n            return{\r\n                title_en:'not set',\r\n                title_pl:'not set',\r\n                description_en:'not set',\r\n                description_pl:'not set',\r\n                link:\"http://afroeuro.istore.pl/\",\r\n                picture:\"http://afrykashop.s3.amazonaws.com/img/market.png\",//change to main folder not admin\r\n                price:'0',\r\n                categories:[],\r\n                status:[]\r\n            }\r\n        }\r\n    })\r\n    //window.Product=Product;\r\n    var Products = StackMob.Collection.extend({\r\n        model:Product\r\n    });\r\n    ////////////////////////////////////////////////////////\r\n    var LoginView = Backbone.View.extend({\r\n        el: 'body',\r\n        events: {\r\n            \"click #btn-signin\": \"validate\",\r\n            \"click #btn-problems\":\"problem\",\r\n            \"keypress #username\": \"onEnter\",\r\n            \"keypress #pass\": \"onEnter\"\r\n        },\r\n        buttonsActive:true,\r\n        initialize: function() {\r\n            this.template = _.template($('#item-login').html());\r\n            this.loader=_.template($('#item-loader').html());\r\n          //  this.render();//rendering in this.brm \r\n        },\r\n        render: function() {\r\n            var el = this.$el;\r\n         //   el.empty();\r\n            el.append(this.template());\r\n            el.append(this.loader());\r\n            \r\n            return this;\r\n        },\r\n        onEnter: function(e) {\r\n            console.debug(e.keyCode);\r\n            if (e.keyCode == 13) {\r\n                if ($('#username').val().replace(/\\W/g, '') === '') $('#username').focus();\r\n                else if ($('#pass').val().replace(/\\W/g, '') === '') $('#pass').focus();\r\n                else this.validate();\r\n            }\r\n\r\n        },\r\n        validate: function() {\r\n            if(this.buttonsActive){\r\n            this.toggleButtons();\r\n            $('#ajax-loader').show();\r\n            var u = $('#username').val().replace(/\\W/g, '');\r\n            var p = $('#pass').val().replace(/\\W/g, '');\r\n            console.log('user: ' + u + \" password: \" + p);\r\n            if (p === '' || u === '') this.loginError();\r\n            else this.admin_login(u, p);\r\n            console.debug(this);\r\n            }\r\n        },\r\n        //logging in---------------------------------------------------------------\r\n        admin_login: function(user_name, user_pass) {\r\n            var user = new StackMob.User({\r\n                username: user_name,\r\n                password: user_pass\r\n            });\r\n            user.login(false, {\r\n                success: function(model) {\r\n                    // redirect user to a new page\r\n                    //admin=model;//because its not the same as StackMob.Model\r\n                    console.debug(model);//assign this to user object\r\n                    \r\n                    console.debug(' navigating to main view');\r\n                    \r\n                    afrykaAdminApp.navigate('/home',true);\r\n                },\r\n                error: function(model, response) {\r\n                    this.toggleButtons();\r\n                    console.debug(response);\r\n                }\r\n            });\r\n            console.debug(user.toJSON());\r\n        },\r\n        loginError: function() {\r\n            $('#ajax-loader').hide();\r\n            this.toggleButtons();\r\n            console.debug('login error function called');\r\n        },\r\n        problem:function(){\r\n            if(this.buttonsActive){\r\n            console.debug('having problems');//problemview on body\r\n            afrykaAdminApp.navigate('/problem',true);\r\n            }\r\n        },\r\n        toggleButtons: function(){\r\n            $('button').toggleClass('disabled',this.buttonsActive);\r\n            this.buttonsActive=!this.buttonsActive;\r\n        },\r\n        multiselectInit: function() {\r\n            $('.multiselect').multiselect({\r\n                buttonClass: 'btn',\r\n                buttonWidth: 'auto',\r\n                buttonContainer: '<div class=\"btn-group\" />',\r\n                maxHeight: false,\r\n                buttonText: function(options) {\r\n                    if (options.length == 0) {\r\n                        return 'None selected <b class=\"caret\"></b>';\r\n                    }\r\n                    else if (options.length > 3) {\r\n                        return options.length + ' selected  <b class=\"caret\"></b>';\r\n                    }\r\n                    else {\r\n                        var selected = '';\r\n                        options.each(function() {\r\n                            selected += $(this).text() + ', ';\r\n                        });\r\n                        return selected.substr(0, selected.length - 2) + ' <b class=\"caret\"></b>';\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    });\r\n    var ProblemView = Backbone.View.extend({\r\n        el: 'body',\r\n        //id:\"problem-content\",\r\n        //className:\"page-region-content \",\r\n        events: {\r\n             \r\n        },\r\n        initialize: function() {\r\n            this.template = _.template($('#item-problem').html());\r\n            //this.rowTemplate= _.template($('#item-cats-row').html());\r\n        },\r\n        render: function() {\r\n            var el = this.$el;\r\n            //   el.empty();\r\n            el.append(this.template());\r\n            return this;\r\n        }\r\n    });\r\n    \r\n    var UserView = Backbone.View.extend({\r\n        //el: 'body',\r\n        id:\"user-content\",\r\n        className:\"page-region-content \",\r\n        events: {\r\n             \r\n        },\r\n        initialize: function() {\r\n            this.template = _.template($('#item-user').html());\r\n            //this.rowTemplate= _.template($('#item-cats-row').html());\r\n        },\r\n        render: function() {\r\n            var el = this.$el;\r\n            //   el.empty();\r\n            el.append(this.template());\r\n            return this;\r\n        }\r\n    });\r\n    \r\n    var MainView = Backbone.View.extend({\r\n        el: 'body',\r\n        events: {\r\n            \"click #m-home\":\"navHome\",\r\n            \"click #m-products\":\"navProducts\",\r\n            \"click #m-categories\":\"navCategories\",\r\n            \"click #m-other\":\"navOther\",\r\n            \"click #m-statii\":\"navStatii\",\r\n            'click #logout-btn':'adminLogout'\r\n        },\r\n        initialize: function() {\r\n           console.debug(this.model.toJSON());\r\n            this.model.bind('all', this.refresh,this);\r\n            this.template=_.template($('#item-main').html());\r\n            this.loaderTemplate=_.template($('#item-loader').html());\r\n        },\r\n        render: function() {\r\n            var el = this.$el;\r\n            el.append(this.template(this.model.toJSON()));\r\n            $('#avatar img').attr('src',function(){\r\n                //console.debug(admin.toJSON().email);\r\n                //maybe check to see if email exists\r\n                return get_gravatar(admin.toJSON().email,80);\r\n            });\r\n            el.append(this.loaderTemplate());\r\n            return this;\r\n        },\r\n        refresh:function(){\r\n            afrykaAdminApp.navigate('/',true);\r\n        },\r\n        navHome:function(){\r\n            afrykaAdminApp.navigate('/home',true);\r\n        },\r\n        navProducts:function(){\r\n            afrykaAdminApp.navigate('/products',true);\r\n        },\r\n        navProduct:function(id){//maybe not necessary??\r\n            afrykaAdminApp.navigate('/product/'+id,true);\r\n        },\r\n        navProductNew:function(id){//maybe not necessary??\r\n            afrykaAdminApp.navigate('/new/product' ,true);\r\n        },\r\n        navCategories:function(){\r\n            afrykaAdminApp.navigate('/categories',true);\r\n        },\r\n        navOther:function(){\r\n            afrykaAdminApp.navigate('/other',true);\r\n        },\r\n        navStatii:function(){\r\n            afrykaAdminApp.navigate('/statii',true);\r\n        },\r\n        navUser:function(){//maybe not necessary\r\n            //get username\r\n            afrykaAdminApp.navigate('/user/'+username,true);//maybe include user id\r\n        },\r\n        goHome: function(mv){//mainvew instance\r\n            console.debug('going home, showing homeview');\r\n            if(!mv.homeView){\r\n                \r\n            console.debug('gohome: homeview doesnt exist');\r\n            mv.homeView = new HomeView();\r\n                    mv.homeView.parent = mv;\r\n            }else{\r\n                console.debug('gohome: homeview exists');\r\n                mv.homeView.delegateEvents();\r\n               // if(this.sideBarView){\r\n                 //   this.sideBarView.delegateEvents();\r\n                //}       \r\n            }\r\n            // afrykaAdminApp.navigate('/home',true);\r\n            afrykaAdminApp.prm.showView(mv.homeView);\r\n            afrykaAdminApp.activeNav('#m-home');\r\n            $('#ajax-loader').hide();\r\n        },\r\n        goCategories: function(mv){\r\n            console.debug('going cats,fetching , showing catsview');\r\n            if(!cats) \r\n                cats = new Cats();\r\n            cats.fetch({\r\n                success:function(){\r\n                    console.debug('mainview,goCategories:cats have been fetched');\r\n                    mv.catsView = new CatsView({collection:cats});\r\n                    mv.catsView.parent = mv;\r\n                    console.debug(mv);\r\n                    afrykaAdminApp.prm.showView(mv.catsView);\r\n                    afrykaAdminApp.activeNav('#m-categories');\r\n                    $('#ajax-loader').hide();\r\n                },\r\n                error:function(){\r\n                    //do something\r\n                    //show alert\r\n                    console.debug('mainview,goCategories:cats have not been fetched');\r\n                }\r\n            });\r\n           // afrykaAdminApp.navigate('/home',true);  \r\n        },\r\n        goStatii: function(mv){\r\n            console.debug('going statii, showing statiiview');\r\n            if(!statii) \r\n                statii = new Statii();\r\n            statii.fetch({\r\n                success:function(){\r\n                    console.debug('mainview,goStatii:statii have been fetched');\r\n                    mv.statiiView = new StatiiView({collection:statii});\r\n                    mv.statiiView.parent = mv;\r\n                    afrykaAdminApp.prm.showView(mv.statiiView);\r\n                    afrykaAdminApp.activeNav('#m-statii');\r\n                    $('#ajax-loader').hide();\r\n                },\r\n                error:function(){\r\n                    //do something\r\n                    //show alert\r\n                    console.debug('mainview,goStatii:statii have not been fetched');\r\n                }\r\n            });\r\n            \r\n           // afrykaAdminApp.navigate('/home',true);\r\n          // afrykaAdminApp.prm.showView(this.statiiView);\r\n        },\r\n        goProducts: function(mv){\r\n            console.debug('going productlist, showing productsview');\r\n            if(!products) \r\n                products = new Products();\r\n                if(!cats)\r\n                    cats = new Cats();\r\n                    console.debug('cats async before');\r\n                    cats.fetch({async:false});\r\n                    console.debug('cats async after');\r\n                if(!statii)\r\n                    statii = new Statii();\r\n                    statii.fetch({async:false});\r\n            products.fetch({\r\n                success:function(){\r\n                    console.debug('mainview,goProducts:products have been fetched');\r\n                    mv.productsView = new ProductsView({collection:products,statii:statii,cats:cats});\r\n                    mv.productsView.parent = mv;\r\n                    afrykaAdminApp.prm.showView(mv.productsView);\r\n                    afrykaAdminApp.activeNav('#m-products');\r\n                    $('#ajax-loader').hide();\r\n                },\r\n                error:function(){\r\n                    //do something\r\n                    //show alert\r\n                    console.debug('mainview,goProducts:products have not been fetched');\r\n                }\r\n            });\r\n            \r\n           // afrykaAdminApp.navigate('/home',true);\r\n          // afrykaAdminApp.prm.showView(this.productsView);\r\n        },\r\n        goProduct: function(mv,id) {\r\n            console.debug('going product, showing productview');\r\n        \r\n            // afrykaAdminApp.navigate('/home',true);\r\n            if (!products){\r\n                products = new Products();\r\n                 if(!cats)\r\n                    cats = new Cats();\r\n                    console.debug('cats async before');\r\n                    cats.fetch({async:false});\r\n                    console.debug('cats async after');\r\n                if(!statii)\r\n                    statii = new Statii();\r\n                    statii.fetch({async:false});\r\n                products.fetch({\r\n                    success: function() {\r\n                        console.debug('mainview,goProduct:products have been fetched');\r\n                        curProd = products.get(id);//if product isnt there display error\r\n                        //console.debug(curProd.toJSON());\r\n                        mv.productView = new ProductView({\r\n                            model: curProd,statii:statii,cats:cats\r\n                        });\r\n                        mv.productView.parent = mv;\r\n                        afrykaAdminApp.prm.showView(mv.productView);\r\n                        $('#ajax-loader').hide();\r\n                    },\r\n                    error: function(){\r\n                        //do something\r\n                        //show alert\r\n                        console.debug('mainview,goProduct:products have not been fetched');\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                curProd = products.get(id);//if product isnt there display error\r\n                console.debug(curProd.toJSON());\r\n                 if(!cats)//crying for optimisation\r\n                    cats = new Cats();\r\n                    console.debug('cats async before');\r\n                    cats.fetch({async:false});\r\n                    console.debug('cats async after');\r\n                if(!statii)\r\n                    statii = new Statii();\r\n                    statii.fetch({async:false});\r\n                mv.productView = new ProductView({\r\n                    model: curProd,statii:statii,cats:cats\r\n                });\r\n                mv.productView.parent = mv;\r\n                afrykaAdminApp.prm.showView(mv.productView);\r\n                $('#ajax-loader').hide();\r\n            }\r\n        },\r\n        goOther: function(mv){\r\n            console.debug('going stats, showing statsview');\r\n            console.debug(this);\r\n            mv.otherView = new OtherView();\r\n            mv.otherView.parent = mv;\r\n           // afrykaAdminApp.navigate('/home',true);\r\n           afrykaAdminApp.prm.showView(mv.otherView);\r\n           afrykaAdminApp.activeNav('#m-other');\r\n           $('#ajax-loader').hide();\r\n        },\r\n        goUser:function(mv){\r\n            console.debug('going jokes, showing jokesview');\r\n            mv.userView = new UserView({model:admin});\r\n            mv.userView.parent = mv;\r\n            // afrykaAdminApp.navigate('/home',true);\r\n            afrykaAdminApp.prm.showView(mv.userView);\r\n            $('#ajax-loader').hide();\r\n        },\r\n        goCatsEdit:function(mv,id){\r\n            console.debug('gocatsedit:rendering dialogbox');\r\n            console.debug(this);\r\n            var model = cats.get(id);\r\n            console.debug('id:'+id);\r\n            console.debug(model);\r\n            //mv.editCategoryModalView \r\n            var ecmv = new EditCategoryModalView({model:model});\r\n            mv.editCategoryModalView = ecmv; \r\n            ecmv.parent = mv;\r\n            afrykaAdminApp.mm.showView(ecmv);\r\n           // var m = model.toJSON();\r\n            \r\n        },\r\n        goStatiiEdit:function(mv,id){\r\n            console.debug('gostatiiedit:rendering dialogbox');\r\n            console.debug(this);\r\n            var model = statii.get(id);\r\n            console.debug('id:'+id);\r\n            console.debug(model);\r\n            //mv.editCategoryModalView \r\n            var esmv = new EditStatusModalView({model:model});\r\n            mv.editStatusModalView = esmv; \r\n            esmv.parent = mv;\r\n            afrykaAdminApp.mm.showView(esmv);\r\n           // var m = model.toJSON();\r\n            \r\n        },\r\n        goProductNew:function(mv){\r\n            console.debug('goproductnew:rendering dialogbox');\r\n            console.debug(this);\r\n            if (!products) products = new Products();\r\n            if (!cats) cats = new Cats();\r\n            console.debug('cats async before');\r\n            cats.fetch({\r\n                async: false\r\n            });\r\n            console.debug('cats async after');\r\n            if (!statii) statii = new Statii();\r\n            statii.fetch({\r\n                async: false\r\n            });\r\n            /*products.fetch({\r\n                success:function(){\r\n                    console.debug('mainview,goProducts:products have been fetched');\r\n                    mv.productsView = new ProductsView({collection:products});\r\n                    mv.productsView.parent = mv;\r\n                    afrykaAdminApp.prm.showView(mv.productsView);\r\n                    afrykaAdminApp.activeNav('#m-products');\r\n                    $('#ajax-loader').hide();\r\n                },\r\n                error:function(){\r\n                    //do something\r\n                    //show alert\r\n                    console.debug('mainview,goProducts:products have not been fetched');\r\n                }\r\n            });*/\r\n            //var npmv = new NewProductModalView({collection:products});\r\n            var npv = new NewProductView({collection:products,statii:statii,cats:cats});\r\n            //mv.newProductModalView = npmv;\r\n            mv.newProductView = npv; \r\n            npv.parent = mv;\r\n            //afrykaAdminApp.mm.showView(npmv);\r\n            afrykaAdminApp.prm.showView(npv);\r\n           // var m = model.toJSON();\r\n           $('#ajax-loader').hide();\r\n            \r\n        },\r\n        goStatusNew:function(mv){\r\n            console.debug('gostatusnew:rendering dialogbox');\r\n            console.debug(this);\r\n            if(!statii) \r\n                statii = new Statii();\r\n            /*products.fetch({\r\n                success:function(){\r\n                    console.debug('mainview,goProducts:products have been fetched');\r\n                    mv.productsView = new ProductsView({collection:products});\r\n                    mv.productsView.parent = mv;\r\n                    afrykaAdminApp.prm.showView(mv.productsView);\r\n                    afrykaAdminApp.activeNav('#m-products');\r\n                    $('#ajax-loader').hide();\r\n                },\r\n                error:function(){\r\n                    //do something\r\n                    //show alert\r\n                    console.debug('mainview,goProducts:products have not been fetched');\r\n                }\r\n            });*/\r\n            var nsmv = new NewStatusModalView({collection:statii});\r\n            mv.newStatusModalView = nsmv; \r\n            nsmv.parent = mv;\r\n            afrykaAdminApp.mm.showView(nsmv);\r\n            $('#ajax-loader').hide();\r\n        },\r\n        goCatNew:function(mv){\r\n            console.debug('gocatnew:rendering dialogbox');\r\n            console.debug(this);\r\n            if(!cats) \r\n                cats = new Cats();\r\n            var ncmv = new NewCategoryModalView({collection:cats});\r\n            mv.newCategoryModalView = ncmv; \r\n            ncmv.parent = mv;\r\n            afrykaAdminApp.mm.showView(ncmv);\r\n            $('#ajax-loader').hide();\r\n           // var m = model.toJSON();\r\n        },\r\n        showAlert:function(mode){\r\n            switch(mode){\r\n                case 'success':\r\n                    $('.alert-success').fadeIn().delay(3000).fadeOut();\r\n                    break;    \r\n                case 'error':\r\n                    $('.alert-error').fadeIn().delay(3000).fadeOut();\r\n                    break;\r\n            }       \r\n        },\r\n        adminLogout:function(){\r\n            console.debug(this);\r\n            me=this;\r\n            admin.logout({\r\n                success:function(model){\r\n                //console.debug(this);\r\n                console.debug('succes'+model)\r\n                me.refresh();\r\n                },\r\n                error:function(model,response){\r\n                     console.debug('error'+model);\r\n                      console.debug(response);\r\n                }    \r\n            });\r\n        }\r\n    });\r\n    ////////////////////////////////////////////////////////\r\n    var HomeView = Backbone.View.extend({\r\n        /*el: '',*/\r\n        id:\"home-content\",\r\n        className:\"page-region-content\", \r\n        events: {\r\n            'click #new-product-pane': 'goToNewProduct'\r\n        },\r\n        initialize: function() {\r\n            this.template = _.template($('#item-home').html());\r\n        },\r\n        render: function() {\r\n            var el = this.$el;\r\n          //  $('.page-region-content').remove();\r\n            //el.append(this.template());\r\n            el.html(this.template());\r\n         \r\n            return this;\r\n        },\r\n        goToNewProduct:function(){//popup\r\n            //navigate\r\n            // afrykaAdminApp.navigate('/product/new',true);\r\n            this.parent.navProductNew();\r\n        }\r\n    });\r\n    var ProductsView = Backbone.View.extend({\r\n        //el:'',\r\n        //tagName:'ul',\r\n        id:\"products-content\",\r\n        className:\"page-region-content\",\r\n        events:{\r\n            \"click tbody tr\":\"goProductPage\",\r\n            \"click #products-add-btn\":\"goNewProduct\",\r\n            'keyup .search-query':'search' \r\n        },\r\n        initialize:function(){\r\n            this.collection.bind('all', this.render,this);\r\n            this.template=_.template($('#item-products').html());\r\n            this.rowTemplate= _.template($('#item-products-row').html());\r\n            this.queryCats=[];\r\n            this.queryStatii=[];\r\n        },\r\n        render: function(){\r\n            var el = this.$el;\r\n            console.debug('rendering productsview');\r\n            var collection = this.collection;\r\n            var rowTemplate = this.rowTemplate;\r\n            el.html(this.template());\r\n            this.initMultiselect();\r\n            collection.each(function(product){\r\n                el.find('tbody').append(rowTemplate(product.toJSON()));   \r\n                });\r\n            if(collection.length===0)\r\n                el.find('tbody').html('No products have been found');\r\n            return this;   \r\n        },\r\n        renderTable:function(){\r\n            var el = this.$el; \r\n            console.debug('rendering table products');\r\n            //$('.page-sidebar').empty();//can be remove on this.class\r\n            var collection = this.collection;\r\n            var rowTemplate = this.rowTemplate;\r\n            //el.html(this.template());\r\n            el.find('tbody').html('');\r\n            collection.each(function(product){\r\n                el.find('tbody').append(rowTemplate(product.toJSON()));       \r\n                });\r\n            return this;   \r\n        },\r\n        noResults:function(){\r\n            this.$el.find('tbody').html('No results found');\r\n        },\r\n        goProductPage:function(ev){\r\n            console.debug('going product page');\r\n            console.debug($(ev.target).data('id'));\r\n            console.debug(ev);\r\n            console.debug(ev.target);\r\n            console.debug($(ev.target).parent());\r\n            console.debug(this.parent);\r\n            this.parent.navProduct($(ev.target).parent().data('id'));\r\n        },\r\n        goNewProduct:function(){ \r\n            this.parent.navProductNew();\r\n        },\r\n        showProductEdit:function(ev){\r\n            console.debug('showproductedit:tr clicked')\r\n            console.debug($(ev.target).data('id'));\r\n            console.debug(ev);\r\n            console.debug(ev.target);\r\n            console.debug($(ev.target).parent());\r\n            console.debug(this.parent);\r\n            this.parent.goProductsEdit(this.parent,$(ev.target).parent().data('id'));\r\n        },\r\n        search:function(){\r\n            //maybe strip preceeding whitespaces\r\n            \r\n            var sq=$('.search-query').val().toLocaleLowerCase().trim();\r\n            console.debug('searching for:'+sq+':are we?');\r\n            if(sq!==''){ \r\n               var searchCollection = new Products();\r\n                products.each(function(product){\r\n                  var  p=product.toJSON();\r\n                    if (p.title_en &&p.title_en.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product);\r\n                    } \r\n                    else if (p.title_pl&&p.title_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product); \r\n                    }    \r\n                    else if (p.description_en&&p.description_en.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product);\r\n                    }\r\n                    else if (p.description_pl&&p.description_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(product);\r\n                    } \r\n                });\r\n                console.debug(searchCollection.toJSON());\r\n                if(searchCollection.length!==0){\r\n                   this.collection=searchCollection; \r\n                   this.renderTable();\r\n                }\r\n                else{\r\n                    this.noResults();\r\n                }\r\n            }\r\n            else{\r\n                this.collection=products;\r\n                this.renderTable();\r\n            }\r\n//            console.debug('searching for:'+sq+':are we?');\r\n        },\r\n        filterSelects:function(el,checked){\r\n            //im using this.parent here because this is not the view but the button :P\r\n            // console.debug(this);\r\n            console.debug(this.parent);\r\n            //console.debug(el.attr('class'));\r\n          //  window.pusy=el;\r\n            //var qc=this.parent.queryCats;\r\n            //var qs= this.parent.queryStatii;\r\n            var val=el.val();\r\n            if(checked){\r\n                console.debug('checked is true');\r\n                switch(el.attr('class')){\r\n                    case 'statii':\r\n                        console.debug('statii change');\r\n                        this.parent.queryStatii.push(val);\r\n                        break;\r\n                    case 'cats':\r\n                        console.debug('cats change');\r\n                        this.parent.queryCats.push(val);\r\n                        break;\r\n                }\r\n            }\r\n            else{console.debug('checked is false');\r\n                switch(el.attr('class')){\r\n                    \r\n                    case 'statii':\r\n                        console.debug('statii change');\r\n                        this.parent.queryStatii=_.without(this.parent.queryStatii,val);\r\n                        break;\r\n                    case 'cats':\r\n                        console.debug('statii change');\r\n//                        qc=_.without(qc,val);\r\n                        this.parent.queryCats=_.without(this.parent.queryCats,val);\r\n                        break;\r\n                }\r\n            }\r\n        \r\n            //console.debug(el);\r\n            //window.pusy=el;\r\n            //console.debug(checked);\r\n            console.debug('cats'+this.parent.queryCats);\r\n            console.debug('statii'+this.parent.queryStatii);\r\n            //do something like in search\r\n        },\r\n        initMultiselect: function() {\r\n            var c=this.$el.find('#products-cats-select');\r\n            var s=this.$el.find('#products-statii-select');\r\n            var me=this;\r\n            this.options.cats.each(function(cat){\r\n                var ca=cat.toJSON(); \r\n                c.append('<option class=\"cats\" value=\"'+ca.category_id+'\">'+ca.title_en+'</option>');\r\n            });\r\n            this.options.statii.each(function(status){\r\n                var st =status.toJSON();\r\n                s.append('<option class=\"statii\" value=\"'+st.status_id+'\">'+st.name+'</option>');\r\n            });\r\n            this.$el.find('.multiselect').multiselect({\r\n                buttonClass: 'btn',\r\n                buttonWidth: '100%',\r\n                buttonContainer: '<div class=\"btn-group multiselect-btn\" />',\r\n                maxHeight: false,\r\n                onChange:me.filterSelects,\r\n                parent:me,\r\n                buttonText: function(options) {\r\n                    if (options.length === 0) {\r\n                        return 'None selected <b class=\"caret\"></b>';\r\n                    }\r\n                    else if (options.length > 3) {\r\n                        return options.length + ' selected  <b class=\"caret\"></b>';\r\n                    }\r\n                    else {\r\n                        var selected = '';\r\n                        options.each(function() {\r\n                            selected += $(this).text() + ', ';\r\n                        });\r\n                        return selected.substr(0, selected.length - 2) + ' <b class=\"caret\"></b>';\r\n                    }\r\n                }\r\n            });\r\n             if(this.options.cats.length===0) \r\n                c.next().find('ul').append('<i>no categories set</i>');\r\n            \r\n            if(this.options.statii.length===0) \r\n                s.next().find('ul').append('<i>no status set</i>');\r\n               //console.debug(s.next().find('ul'));\r\n        }\r\n    });\r\n    var ProductView = Backbone.View.extend({// pass in type in the options \r\n        id:\"product-content\",\r\n        className:\"page-region-content\",\r\n        events:{\r\n            'click #product-edit-btn-upload':'filePick',\r\n            'change #product-pic-upload':'handleFileSelect',\r\n            'click #product-edit-btn-save':'save',\r\n            'click #product-edit-btn-close':'goBack',\r\n            'click #product-edit-btn-delete':'delete',\r\n            'click #select-add-status':'goStatusNew',\r\n            'click #select-add-category':'goCatNew'\r\n        },\r\n        modified:false,\r\n        fieldName:'picture',\r\n        fName:'',\r\n        fType:'', \r\n        base64Content:'',\r\n        \r\n        initialize:function(){\r\n            this.template=_.template($('#item-product').html());\r\n            var p= this.model.toJSON();\r\n            this.selectedCats=[];\r\n            this.selectedStatii=[];\r\n            //populate arrays with initial data from model\r\n            for(i=0;i<p.categories.length;i++){\r\n                this.selectedCats.push(p.categories[i]);\r\n            }\r\n            for(i=0;i<p.status.length;i++){\r\n                this.selectedStatii.push(p.status[i]);\r\n            }\r\n        }, \r\n        render:function(){\r\n            var el = this.$el;\r\n            console.debug('rendering productsview');\r\n            el.html(this.template(this.model.toJSON()));\r\n            this.initMultiselect();\r\n            return this;    \r\n        },\r\n        save: function() {\r\n            var updated = {};\r\n            var p =this.model.toJSON();\r\n            var tit_pl = $('#product-edit-title_pl').val();\r\n            var tit_en = $('#product-edit-title_en').val();\r\n            var link = $('#product-edit-link').val();\r\n            var price = $('#product-edit-price').val();\r\n            var des_en = $('#product-edit-description_en').val();\r\n            var des_pl = $('#product-edit-description_pl').val();\r\n            var dpl=$('#product-edit-description_pl').data('oldcontent');\r\n            var den=$('#product-edit-description_en').data('oldcontent');;\r\n            var base64Content=this.base64Content;\r\n            var fType=this.fType;\r\n            var fName=this.fName.replace(/\\W/g, '');\r\n            var fieldName=this.fieldName;\r\n            console.debug(this);\r\n           // console.debug('fType:'+this.fType);\r\n            //console.debug('fName:'+this.fName);\r\n            //console.debug('base64Content:'+this.base64Content);\r\n            //console.debug('fieldName:'+this.fieldName)\r\n            if(!arraysEqual(this.selectedCats,p.categories)){\r\n                updated.categories = this.selectedCats;\r\n                this.modified = true;\r\n            }\r\n            if(!arraysEqual(this.selectedStatii,p.status)){\r\n                updated.status = this.selectedStatii;\r\n                this.modified = true;\r\n            }\r\n            if (tit_pl != '') {\r\n                updated.title_pl = tit_pl;\r\n                this.modified = true;\r\n            }\r\n            if (tit_en != '') {\r\n                updated.title_en = tit_en;\r\n                this.modified = true;\r\n            }\r\n            if (link != '') {\r\n                updated.link = link;\r\n                this.modified = true;\r\n            }\r\n            if (price != '') {\r\n                updated.price = price;\r\n                this.modified = true;\r\n            }\r\n            if (des_en != den) {\r\n                updated.description_en = des_en;\r\n                this.modified = true;\r\n            }\r\n            if (des_pl != dpl) {\r\n                updated.description_pl = des_pl;\r\n                this.modified = true;\r\n            }\r\n            if (base64Content != '' && fType != '' && fName != '') {\r\n                //alert('picture changed');\r\n                this.model.setBinaryFile(fieldName, fName, fType, base64Content);\r\n                this.modified = true;\r\n            }\r\n            else{//workaround because stackmob is overwriting my picture\r\n               // updated.picture = this.model.toJSON().picture;\r\n            }\r\n            if (this.modified) {\r\n                var me = this;\r\n                $('#ajax-loader').show();\r\n                console.debug(_.isEmpty(updated));\r\n               // if (!_.isEmpty(updated)) {\r\n                    console.debug(updated);\r\n                    if (!this.base64Content) {\r\n                        console.debug('image unchanged');\r\n                        this.model.save(updated, {\r\n                            remote_ignore: ['picture'],\r\n                            success: function(model) {\r\n                                $('#ajax-loader').hide();\r\n                                mainView.showAlert('success');\r\n                                me.parent.navProducts();\r\n                            },\r\n                            error: function(model, response) {\r\n                                $('#ajax-loader').hide();\r\n                                mainView.showAlert('error');\r\n                                console.error(model);\r\n                                console.error(response);\r\n                            }\r\n                        });\r\n                    }\r\n                    else{\r\n                        this.model.save(updated, {\r\n                        success: function(model) {\r\n                            $('#ajax-loader').hide();\r\n                            mainView.showAlert('success');\r\n                            me.parent.navProducts();\r\n                        },\r\n                        error: function(model, response) {\r\n                            $('#ajax-loader').hide();\r\n                            mainView.showAlert('error');\r\n                            console.error(model);\r\n                            console.error(response);\r\n                        }\r\n                    });\r\n                    }\r\n                    \r\n                /*}\r\n                else {\r\n                    console.debug('only image changed');\r\n                    this.model.save({\r\n                        success: function(model) {\r\n                            $('#ajax-loader').hide();\r\n                            mainView.showAlert('success');\r\n                            me.parent.navProducts();\r\n                        },\r\n                        error: function(model, response) {\r\n                            $('#ajax-loader').hide();\r\n                            mainView.showAlert('error');\r\n                        }\r\n                    });\r\n                }*/\r\n            }\r\n            else {\r\n                alert('You have not made any changes');\r\n            }\r\n            return this;\r\n        },\r\n        handleFileSelect: function(evt) {\r\n            var files = evt.target.files; // FileList object\r\n            me=this;\r\n            // Loop through the FileList\r\n            for (var i = 0, f; f = files[i]; i++) {\r\n        \r\n                var reader = new FileReader();\r\n        \r\n                // Closure to capture the file information\r\n                reader.onload = (function(theFile) {\r\n                    return function(e) {\r\n        \r\n                        /*\r\n                             e.target.result will return \"data:image/jpeg;base64,[base64 encoded data]...\".\r\n                             We only want the \"[base64 encoded data] portion, so strip out the first part\r\n                           */\r\n                        //var base64Content = e.target.result.substring(e.target.result.indexOf(',') + 1, e.target.result.length);\r\n                         me.base64Content = e.target.result.substring(e.target.result.indexOf(',') + 1, e.target.result.length);\r\n                        //var fileName = theFile.name;\r\n                        me.fName = theFile.name;\r\n                        //var fileType = theFile.type;\r\n                        $('#product-edit-btn-upload').html(theFile.name).attr({title:theFile.name+': uploaded'}).addClass('btn-success');\r\n                       \r\n                        \r\n                        me.fType = theFile.type;        \r\n                        //todoInstance.setBinaryFile(fieldname, fileName, fileType, base64Content);\r\n                        //todoInstance.save();\r\n                        console.debug(e.target.result);\r\n                        $('.product-modal-img').attr({src: e.target.result}).addClass('image-updated');\r\n                    };\r\n                })(f);\r\n        \r\n                // Read in the file as a data URL\r\n                 fileContent = reader.readAsDataURL(f);\r\n                //console.debug(fileContent);\r\n                //console.debug(reader.result);\r\n                 \r\n            }\r\n        },\r\n        filePick: function() {\r\n            // Check for the various File API support.\r\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\r\n                // Great success! All the File APIs are supported.\r\n                $('#product-pic-upload').click();\r\n            }\r\n            else {\r\n                 alert('Uploading Files is not fully supported in this browser please try using a modern browser.');\r\n            }\r\n         },\r\n        goBack:function(){\r\n            //check for changes if changes made then prompt to save yes/no\r\n            var pc=this.model.toJSON().categories;\r\n            var ps=this.model.toJSON().status;\r\n            var sc=this.selectedCats;\r\n            var ss=this.selectedStatii;\r\n            var tit_pl = $('#product-edit-title_pl').val();\r\n            var tit_en = $('#product-edit-title_en').val();\r\n            var link = $('#product-edit-link').val();\r\n            var price = $('#product-edit-price').val();\r\n            var des_en = $('#product-edit-description_en').val();\r\n            var dpl=$('#product-edit-description_pl');\r\n            var den=$('#product-edit-description_en');\r\n            var des_pl = $('#product-edit-description_pl').val();\r\n            var base64Content=this.base64Content;\r\n            var fType=this.fType;\r\n            var fName=this.fName;\r\n            //console.debug(pl.val());\r\n        if (tit_pl !== '' || tit_en !== ''||link !== ''||price !== ''|| (base64Content !== '' && fType !== '' && fName !== '')||des_en !== den.data('oldcontent')||des_pl !== dpl.data('oldcontent')||!arraysEqual(sc,pc)||!arraysEqual(ss,ps)) {\r\n            var r = confirm('You have unsaved data are you sure you want to leave?');\r\n            if (r === true) {\r\n                this.parent.navProducts();\r\n            }\r\n            }\r\n        else this.parent.navProducts();\r\n        },\r\n        delete: function() {\r\n            var r = confirm('Are you sure you want to delete this product?');\r\n            if (r === true) {\r\n                var me=this;\r\n                $('#ajax-loader').show();\r\n                this.model.destroy({\r\n                    success: function(model) {\r\n                        console.debug(model.toJSON());\r\n                        $('#ajax-loader').hide();\r\n                        me.parent.showAlert('success');\r\n                        me.parent.navProducts();\r\n                    },\r\n                    error: function(model, response) {\r\n                        //console.debug(response);\r\n                        $('#ajax-loader').hide();\r\n                        //mainView.showAlert('error');\r\n                        me.parent.navProducts();\r\n                    }\r\n                });\r\n            }\r\n        },\r\n        filterSelects:function(el,checked){\r\n            //im using this.parent here because this is not the view but the button :P\r\n            // console.debug(this);\r\n            console.debug(this.parent);\r\n            var val=el.val();\r\n            if(checked){\r\n                console.debug('checked is true');\r\n                switch(el.attr('class')){\r\n                    case 'statii':\r\n                        console.debug('statii change');\r\n                        this.parent.selectedStatii.push(val);\r\n                        break;\r\n                    case 'cats':\r\n                        console.debug('cats change');\r\n                        this.parent.selectedCats.push(val);\r\n                        break;\r\n                }\r\n            }\r\n            else{console.debug('checked is false');\r\n                switch(el.attr('class')){\r\n                    \r\n                    case 'statii':\r\n                        console.debug('statii change');\r\n                        this.parent.selectedStatii=_.without(this.parent.selectedStatii,val);\r\n                        break;\r\n                    case 'cats':\r\n                        console.debug('statii change');\r\n//                        qc=_.without(qc,val);\r\n                        this.parent.selectedCats=_.without(this.parent.selectedCats,val);\r\n                        break;\r\n                }\r\n            }\r\n        \r\n            //console.debug(el);\r\n            //window.pusy=el;\r\n            //console.debug(checked);\r\n            console.debug('cats'+this.parent.selectedCats);\r\n            console.debug('statii'+this.parent.selectedStatii);\r\n            //do something like in search\r\n        },\r\n        initMultiselect:function(){\r\n            var c=this.$el.find('#product-edit-cats-select');\r\n            var s=this.$el.find('#product-edit-statii-select');\r\n            var me=this;\r\n            var pc=this.model.toJSON().categories;\r\n            var ps=this.model.toJSON().status;\r\n            this.options.cats.each(function(cat){\r\n                var ca=cat.toJSON(); \r\n                var selected=pc.indexOf(ca.category_id)!==-1?\"selected\":\"\";\r\n                c.prepend('<option class=\"cats\" value=\"'+ca.category_id+'\"'+selected+'>'+ca.title_en+'</option>');\r\n            });\r\n            this.options.statii.each(function(status){\r\n                var st =status.toJSON();\r\n                var selected=ps.indexOf(st.status_id)!==-1?\"selected\":\"\";\r\n                s.prepend('<option class=\"statii\" value=\"'+st.status_id+'\"'+selected+'>'+st.name+'</option>');\r\n            });\r\n            this.$el.find('.multiselect').multiselect({\r\n                buttonClass: 'btn btn-small',\r\n                buttonWidth: '100%',\r\n                buttonContainer: '<div class=\"btn-group multiselect-btn product-select-button\" />',\r\n                maxHeight: false,\r\n                onChange:me.filterSelects,\r\n                parent:me,\r\n                buttonText: function(options) {\r\n                    if (options.length === 0) {\r\n                        return 'None selected <b class=\"caret\"></b>';\r\n                    }\r\n                    else if (options.length > 3) {\r\n                        return options.length + ' selected  <b class=\"caret\"></b>';\r\n                    }\r\n                    else {\r\n                        var selected = '';\r\n                        options.each(function() {\r\n                            selected += $(this).text() + ', ';\r\n                        });\r\n                        return selected.substr(0, selected.length - 2) + ' <b class=\"caret\"></b>';\r\n                    }\r\n                }\r\n            });\r\n            // if(this.options.cats.length===0) \r\n                c.next().find('ul').append('<a class=\"btn select-menu-btn\" id=\"select-add-category\">add new category</a>');\r\n            \r\n            //if(this.options.statii.length===0) \r\n                s.next().find('ul').append('<a class=\"btn select-menu-btn\" id=\"select-add-status\">add new status</a>');\r\n               //console.debug(s.next().find('ul'));\r\n        },\r\n        goStatusNew: function(){\r\n            this.parent.goStatusNew(this);\r\n        },\r\n        goCatNew: function(){\r\n            this.parent.goCatNew(this);\r\n        }\r\n        \r\n    });\r\n    var CatsView = Backbone.View.extend({\r\n        id:\"categories-content\",\r\n        className:\"page-region-content container-fluid\",\r\n        events:{\r\n            \"click tbody tr\":\"showCatEdit\",\r\n            \"click #cats-add-btn\":\"goNewCat\",\r\n            'keyup .search-query':'search' \r\n        },\r\n        initialize:function(){\r\n            //this.model = this.options.model;\r\n            this.collection.bind('all', this.render,this);\r\n            this.template = _.template($('#item-cats').html());\r\n            this.rowTemplate= _.template($('#item-cats-row').html());\r\n        },\r\n        render:function(){\r\n           var el = this.$el;\r\n            var collection = this.collection;\r\n            var rowTemplate = this.rowTemplate;\r\n          //  $('.page-region-content').remove();\r\n            el.html(this.template());\r\n            collection.each(function(cat){\r\n                el.find('tbody').append(rowTemplate(cat.toJSON()));       \r\n                });\r\n                if(collection.length===0)\r\n                el.find('tbody').html('No categories have been found');\r\n            return this;\r\n        },\r\n        showCatEdit:function(ev){\r\n            console.debug('showcatedit:tr clicked')\r\n            //if (!this.parent.sideBarView){\r\n              //  this.parent.sideBarView=new SideBarView();\r\n                //this.parent.sideBarView.parent = this.parent;\r\n            //}\r\n            console.debug($(ev.target).data('id'));\r\n           // console.debug(ev);\r\n            //console.debug(ev.target);\r\n            console.debug($(ev.target).parent());\r\n            console.debug(this.parent);\r\n            //this.parent.sideBarView.goCatsEdit($(ev.target).parent().data('id'));\r\n            this.parent.goCatsEdit(this.parent,$(ev.target).parent().data('id'));\r\n            \r\n        },\r\n        goNewCat:function(){\r\n            var mv= this.parent;\r\n            mv.goCatNew(this);\r\n        },\r\n        refresh:function(){\r\n            //refresh the catview somehow\r\n            //remove\r\n        },\r\n        renderTable:function(){\r\n            var el = this.$el; \r\n            console.debug('rendering table cats');\r\n            //$('.page-sidebar').empty();//can be remove on this.class\r\n            var collection = this.collection;\r\n            var rowTemplate = this.rowTemplate;\r\n            //el.html(this.template());\r\n            el.find('tbody').html('');\r\n            collection.each(function(cat){\r\n                el.find('tbody').append(rowTemplate(cat.toJSON()));       \r\n                });\r\n            return this;   \r\n        },\r\n        noResults:function(){\r\n            this.$el.find('tbody').html('No results found');\r\n        },\r\n        search:function(){\r\n            //maybe strip preceeding whitespaces\r\n            \r\n            var sq=$('.search-query').val().toLocaleLowerCase().trim();\r\n            console.debug('searching for:'+sq+':are we?');\r\n            if(sq!==''){ \r\n               var searchCollection = new Cats();\r\n                cats.each(function(cat){\r\n                  var  c=cat.toJSON();\r\n                    if (c.title_en &&c.title_en.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(cat);\r\n                    } \r\n                    else if (c.title_pl&&c.title_pl.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(cat);\r\n                    }\r\n                });\r\n                console.debug(searchCollection.toJSON());\r\n                if(searchCollection.length!==0){\r\n                   this.collection=searchCollection; \r\n                   this.renderTable();\r\n                }\r\n                else{\r\n                    this.noResults();\r\n                }\r\n            }\r\n            else{\r\n                this.collection=products;\r\n                this.renderTable();\r\n            }\r\n//            console.debug('searching for:'+sq+':are we?');\r\n        }\r\n    });//dialog box no need for view object\r\n    var OtherView = Backbone.View.extend({\r\n        id:\"other-content\",\r\n        className:\"page-region-content\",\r\n        events:{},\r\n        initialize:function(){\r\n            this.template = _.template($('#item-other').html());   \r\n        },\r\n        render:function(){\r\n            var el=this.$el;\r\n             //  $('.page-region-content').remove();\r\n            el.append(this.template());\r\n            return this;\r\n        }\r\n    });\r\n    var StatiiView = Backbone.View.extend({\r\n        id:\"statii-content\",\r\n        className:\"page-region-content \",\r\n        events: {\r\n            \"click tbody tr\":\"showStatEdit\",\r\n            \"click #statii-add-btn\":\"goNewStatus\",\r\n            'keyup .search-query':'search' \r\n        },\r\n        initialize: function() {\r\n            this.collection.bind('all', this.render,this);\r\n            this.template = _.template($('#item-statii').html());\r\n            this.rowTemplate = _.template($('#item-statii-row').html());\r\n        },\r\n        render: function() {\r\n            var el=this.$el;\r\n            var collection = this.collection;\r\n            rowTemplate = this.rowTemplate;\r\n            el.html(this.template());\r\n            collection.each(function(status){\r\n                el.find('tbody').append(rowTemplate(status.toJSON()));       \r\n                });\r\n            if(collection.length===0)\r\n                el.find('tbody').html('No statii have been found');\r\n            return this;\r\n        },\r\n        showStatEdit:function(ev){\r\n            console.debug('showStatedit:tr clicked')\r\n            //if (!this.parent.sideBarView){\r\n              //  this.parent.sideBarView=new SideBarView();\r\n                //this.parent.sideBarView.parent = this.parent;\r\n            //}\r\n            console.debug($(ev.target).data('id'));\r\n           // console.debug(ev);\r\n            //console.debug(ev.target);\r\n            console.debug($(ev.target).parent());\r\n            console.debug(this.parent);\r\n            //this.parent.sideBarView.goCatsEdit($(ev.target).parent().data('id'));\r\n            this.parent.goStatiiEdit(this.parent,$(ev.target).parent().data('id'));\r\n            \r\n        },\r\n        goNewStatus:function(){\r\n            var mv= this.parent;\r\n            mv.goStatusNew(mv);\r\n        },\r\n        renderTable:function(){\r\n            var el = this.$el; \r\n            console.debug('rendering table statii');\r\n            //$('.page-sidebar').empty();//can be remove on this.class\r\n            var collection = this.collection;\r\n            var rowTemplate = this.rowTemplate;\r\n            //el.html(this.template());\r\n            el.find('tbody').html('');\r\n            collection.each(function(status){\r\n                el.find('tbody').append(rowTemplate(status.toJSON()));       \r\n                });\r\n            return this;   \r\n        },\r\n        noResults:function(){\r\n            this.$el.find('tbody').html('No results found');\r\n        },\r\n        search:function(){\r\n            //maybe strip preceeding whitespaces\r\n            \r\n            var sq=$('.search-query').val().toLocaleLowerCase().trim();\r\n            console.debug('searching for:'+sq+':are we?');\r\n            if(sq!==''){ \r\n               var searchCollection = new Statii();\r\n                statii.each(function(status){\r\n                  var  s=status.toJSON();\r\n                    if (s.title &&s.title.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(status);\r\n                    } \r\n                    else if (s.description&&s.description.toLocaleLowerCase().indexOf(sq)!==-1) {\r\n                        searchCollection.add(status);\r\n                    }\r\n                });\r\n                console.debug(searchCollection.toJSON());\r\n                if(searchCollection.length!==0){\r\n                   this.collection=searchCollection; \r\n                   this.renderTable();\r\n                }\r\n                else{\r\n                    this.noResults();\r\n                }\r\n            }\r\n            else{\r\n                this.collection=statiiproducts;\r\n                this.renderTable();\r\n            }\r\n//            console.debug('searching for:'+sq+':are we?');\r\n        }\r\n    });\r\n    var NewProductView = Backbone.View.extend({\r\n        id:\"product-new-content\",\r\n        className:\"page-region-content\",\r\n        events: {\r\n            'click #product-new-btn-upload':'filePick',\r\n            'change #product-new-pic-upload':'handleFileSelect',\r\n            'click #product-new-btn-save':'save',\r\n            'click #product-new-btn-close':'goBack',\r\n            'click #select-add-status':'goStatusNew',\r\n            'click #select-add-category':'goCatNew'\r\n            //'click .modal-close':'hide',\r\n             \r\n        },\r\n        modified:false,\r\n        fieldName:'picture',\r\n        fName:'',\r\n        fType:'',\r\n        base64Content:'',\r\n        initialize: function() {\r\n            this.template = _.template($('#item-product-new').html());\r\n            this.selectedCats=[];\r\n            this.selectedStatii=[];\r\n        },\r\n        render: function() {\r\n            this.$el.html(this.template());\r\n            this.initMultiselect();\r\n            return this;\r\n        },\r\n        save: function() {\r\n            var newProduct = new Product();\r\n            var collection=this.collection;\r\n            var tit_pl = $('#product-new-title_pl').val();\r\n            var tit_en = $('#product-new-title_en').val();\r\n            var link = $('#product-new-link').val();\r\n            var price = $('#product-new-price').val();\r\n            var des_en = $('#product-new-description_en').val();\r\n            var des_pl = $('#product-new-description_pl').val();\r\n            var dpl = $('#product-new-description_pl').val();\r\n            var den = $('#product-new-description_en').val();;\r\n            var base64Content = this.base64Content;\r\n            var fType = this.fType;\r\n            var fName = this.fName.replace(/\\W/g, '');\r\n            var fieldName = this.fieldName;\r\n            \r\n            if(this.selectedCats.length>0){\r\n                var sc=this.selectedCats;\r\n                newProduct.set({categories:sc});\r\n                this.modified = true;\r\n            }\r\n            if(this.selectedStatii.length>0){\r\n                var ss=this.selectedStatii;\r\n                newProduct.set({status:ss});\r\n                this.modified = true;\r\n            }\r\n            if (tit_pl != '') {\r\n                newProduct.set({title_pl:tit_pl});\r\n                this.modified = true;\r\n            }\r\n            if (tit_en != '') {\r\n                newProduct.set({title_en:tit_en});\r\n                this.modified = true;\r\n            }\r\n            if (link != '') {\r\n                newProduct.set({link:link});\r\n                this.modified = true;\r\n            }\r\n            if (price != '') {\r\n                newProduct.set({price:price});\r\n                this.modified = true;\r\n            }\r\n            if (des_en != '') {\r\n                newProduct.set({description_en:des_en});\r\n                this.modified = true;\r\n            }\r\n            if (des_pl != '') {\r\n                newProduct.set({description_pl:des_pl});\r\n                this.modified = true;\r\n            }\r\n            if (base64Content != '' && fType != '' && fName != '') {\r\n                //alert('picture changed');\r\n                newProduct.setBinaryFile(fieldName, fName, fType, base64Content);\r\n                this.modified = true;\r\n            }\r\n            else{//workaround because stackmob is overwriting my picture\r\n                //updated.picture = this.model.toJSON().picture;\r\n            }\r\n            if (this.modified) {\r\n                me = this;\r\n                $('#ajax-loader').show();\r\n                //if (updated !== {}) {\r\n                console.debug(newProduct.toJSON());\r\n                newProduct.create({\r\n                    success: function(model) {\r\n                        collection.add(model);\r\n                        console.debug(model);\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('success');\r\n                       // $('.modal').modal('hide');\r\n                        me.parent.navProducts();\r\n                    },\r\n                    error: function(model, response) {\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('error');\r\n                        console.error(model);\r\n                        console.error(response);\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                alert('You havent made any changes');\r\n            }\r\n            return this;\r\n        },\r\n        handleFileSelect: function(evt) {\r\n            var files = evt.target.files; // FileList object\r\n            me=this;\r\n            // Loop through the FileList\r\n            for (var i = 0, f; f = files[i]; i++) {\r\n        \r\n                var reader = new FileReader();\r\n        \r\n                // Closure to capture the file information\r\n                reader.onload = (function(theFile) {\r\n                    return function(e) {\r\n                        /*\r\n                             e.target.result will return \"data:image/jpeg;base64,[base64 encoded data]...\".\r\n                             We only want the \"[base64 encoded data] portion, so strip out the first part\r\n                           */\r\n                        //var base64Content = e.target.result.substring(e.target.result.indexOf(',') + 1, e.target.result.length);\r\n                         me.base64Content = e.target.result.substring(e.target.result.indexOf(',') + 1, e.target.result.length);\r\n                        //var fileName = theFile.name;\r\n                        me.fName = theFile.name;\r\n                        //var fileType = theFile.type;\r\n                        $('#product-new-btn-upload').html(theFile.name).attr({title:theFile.name+': uploaded'}).addClass('btn-success');\r\n                       \r\n                        \r\n                        me.fType = theFile.type;        \r\n                        //todoInstance.setBinaryFile(fieldname, fileName, fileType, base64Content);\r\n                        //todoInstance.save();\r\n                        console.debug(e.target.result);\r\n                        $('.product-modal-img').attr({src: e.target.result}).addClass('image-updated');\r\n                    };\r\n                })(f);\r\n        \r\n                // Read in the file as a data URL\r\n                 fileContent = reader.readAsDataURL(f);\r\n                //console.debug(fileContent);\r\n                //console.debug(reader.result);\r\n                 \r\n            }\r\n        },\r\n        filePick: function() {\r\n            // Check for the various File API support.\r\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\r\n                // Great success! All the File APIs are supported.\r\n                $('#product-new-pic-upload').click();\r\n            }\r\n            else {\r\n                 alert('Uploading Files is not fully supported in this browser please try using a modern browser.');\r\n            }\r\n         },\r\n        goBack:function(){\r\n            //check for changes if changes made then prompt to save yes/no\r\n            var sc=this.selectedCats;\r\n            var ss=this.selectedStatii;\r\n            var tit_pl = $('#product-new-title_pl').val();\r\n            var tit_en = $('#product-new-title_en').val();\r\n            var link = $('#product-new-link').val();\r\n            var price = $('#product-new-price').val();\r\n            var des_en = $('#product-new-description_en').val();\r\n            var dpl=$('#product-new-description_pl');\r\n            var den=$('#product-new-description_en');\r\n            var des_pl = $('#product-new-description_pl').val();\r\n            var base64Content=this.base64Content;\r\n            var fType=this.fType;\r\n            var fName=this.fName;\r\n            //console.debug(pl.val());\r\n            if (tit_pl !== '' || tit_en !== ''||link !== ''||price !== ''|| (base64Content !== '' && fType !== '' && fName !== '')||des_en !== ''||des_pl !== ''||ss.length>0||sc.length>0) {\r\n                var r = confirm('You have unsaved data are you sure you want to leave?');\r\n                if (r == true) {\r\n                    //$('.modal').modal('hide');//go back\r\n                    this.parent.navProducts();\r\n                }\r\n            }\r\n            else this.parent.navProducts();\r\n            //$('.modal').modal('hide');//go back\r\n            },\r\n        filterSelects:function(el,checked){\r\n            //im using this.parent here because this is not the view but the button :P\r\n            // console.debug(this);\r\n            console.debug(this.parent);\r\n            var val=el.val();\r\n            if(checked){\r\n                console.debug('checked is true');\r\n                switch(el.attr('class')){\r\n                    case 'statii':\r\n                        console.debug('statii change');\r\n                        this.parent.selectedStatii.push(val);\r\n                        break;\r\n                    case 'cats':\r\n                        console.debug('cats change');\r\n                        this.parent.selectedCats.push(val);\r\n                        break;\r\n                }\r\n            }\r\n            else{console.debug('checked is false');\r\n                switch(el.attr('class')){\r\n                    \r\n                    case 'statii':\r\n                        console.debug('statii change');\r\n                        this.parent.selectedStatii=_.without(this.parent.selectedStatii,val);\r\n                        break;\r\n                    case 'cats':\r\n                        console.debug('statii change');\r\n    //                        qc=_.without(qc,val);\r\n                        this.parent.selectedCats=_.without(this.parent.selectedCats,val);\r\n                        break;\r\n                }\r\n            }\r\n        \r\n            //console.debug(el);\r\n            //window.pusy=el;\r\n            //console.debug(checked);\r\n            console.debug('cats'+this.parent.selectedCats);\r\n            console.debug('statii'+this.parent.selectedStatii);\r\n            //do something like in search\r\n        },\r\n        initMultiselect:function(){\r\n            var c=this.$el.find('#product-new-cats-select');\r\n            var s=this.$el.find('#product-new-statii-select');\r\n            var me=this;\r\n            this.options.cats.each(function(cat){\r\n                var ca=cat.toJSON(); \r\n                c.prepend('<option class=\"cats\" value=\"'+ca.category_id+'\">'+ca.title_en+'</option>');\r\n            });\r\n            this.options.statii.each(function(status){\r\n                var st =status.toJSON();\r\n                s.prepend('<option class=\"statii\" value=\"'+st.status_id+'\">'+st.name+'</option>');\r\n            });\r\n            this.$el.find('.multiselect').multiselect({\r\n                buttonClass: 'btn btn-small',\r\n                buttonWidth: '100%',\r\n                buttonContainer: '<div class=\"btn-group multiselect-btn product-select-button\" />',\r\n                maxHeight: false,\r\n                onChange:me.filterSelects,\r\n                parent:me,\r\n                buttonText: function(options) {\r\n                    if (options.length === 0) {\r\n                        return 'None selected <b class=\"caret\"></b>';\r\n                    }\r\n                    else if (options.length > 3) {\r\n                        return options.length + ' selected  <b class=\"caret\"></b>';\r\n                    }\r\n                    else {\r\n                        var selected = '';\r\n                        options.each(function() {\r\n                            selected += $(this).text() + ', ';\r\n                        });\r\n                        return selected.substr(0, selected.length - 2) + ' <b class=\"caret\"></b>';\r\n                    }\r\n                }\r\n            });\r\n            // if(this.options.cats.length===0) \r\n                c.next().find('ul').append('<a class=\"btn select-menu-btn\" id=\"select-add-category\">add new category</a>');\r\n            \r\n            //if(this.options.statii.length===0) \r\n                s.next().find('ul').append('<a class=\"btn select-menu-btn\" id=\"select-add-status\">add new status</a>');\r\n               //console.debug(s.next().find('ul'));\r\n        },\r\n        goStatusNew: function(){\r\n            this.parent.goStatusNew(this);\r\n        },\r\n        goCatNew: function(){\r\n            this.parent.goCatNew(this);\r\n        } \r\n    });\r\n    var EditCategoryModalView = Backbone.View.extend({\r\n        events: {\r\n            'click .modal-close':'hide',\r\n            'hidden .modal':'justClose',\r\n            'click #cats-edit-btn-save':'save',\r\n            'click #cats-edit-btn-delete':'delete'\r\n        },\r\n        modified:false,\r\n        initialize: function() {\r\n            this.template = _.template($('#item-cats-edit').html());\r\n           // this.loaderTemplate=_.template($('#item-loader').html());   \r\n        },\r\n        render: function() {\r\n            this.$el.html(this.template(this.model.toJSON()));\r\n            $(document.body).append(this.$el);\r\n            $('.modal').modal({\r\n                keyboard:true,\r\n                backdrop: 'static',\r\n                show:true\r\n                });\r\n            return this;\r\n        },\r\n        save: function() {\r\n            var updated = {};\r\n            pl = $('#cats-edit-title_pl').val();\r\n            en = $('#cats-edit-title_en').val();\r\n            if (pl != '') {\r\n                updated.title_pl = pl;\r\n                this.modified = true;\r\n            }\r\n            if (en != '') {\r\n                updated.title_en = en;\r\n                this.modified = true;\r\n            }\r\n            if (this.modified) {\r\n                me = this;\r\n                $('#ajax-loader').show();\r\n                this.model.save(updated, {\r\n                    success: function(model) {\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('success');\r\n                        $('.modal').modal('hide');\r\n                    },\r\n                    error: function(model, response) {\r\n                        mainView.showAlert('error');\r\n                        $('.modal').modal('hide');\r\n                    }\r\n                });\r\n            }\r\n            else{\r\n                alert('You havent made any changes');\r\n            }\r\n            return this;\r\n        },\r\n        hide:function(){\r\n            //check for changes if changes made then prompt to save yes/no\r\n            pl=$('#cats-edit-title_pl').val();\r\n            en=$('#cats-edit-title_en').val();\r\n            console.debug(pl);\r\n        if (pl !== '' || en !== '') {\r\n            var r = confirm('You have unsaved data are you sure you want to leave?');\r\n            if (r == true) {\r\n                $('.modal').modal('hide');\r\n            }\r\n            }\r\n        else $('.modal').modal('hide');\r\n        },\r\n        justClose: function() {\r\n        //    this.remove();\r\n            afrykaAdminApp.mm.closeView(this);\r\n        },\r\n        delete: function() {\r\n            var r = confirm('Are you sure you want to delete this category?');\r\n            if (r == true) {\r\n                $('#ajax-loader').show();\r\n                this.model.destroy({\r\n                    success: function(model) {\r\n                        console.debug(model.toJSON());\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('success');\r\n                        $('.modal').modal('hide');\r\n                    },\r\n                    error: function(model, response) {\r\n                        //strange things going on here\r\n                       // console.debug(model);\r\n                        //console.debug(response);\r\n                        $('#ajax-loader').hide();\r\n                        $('.modal').modal('hide');\r\n                        //mainView.showAlert('error');\r\n                    }\r\n                });\r\n            }\r\n        }\r\n           \r\n    });\r\n    var NewCategoryModalView = Backbone.View.extend({\r\n        events: {\r\n             'click #cats-new-btn-save':'save',\r\n            //'click #products-edit-btn-close':'goBack',\r\n            'click .modal-close':'hide',\r\n            'hidden .modal':'justClose',\r\n        },\r\n        modified:false,\r\n        initialize: function() {\r\n            this.template = _.template($('#item-cats-new').html());\r\n        },\r\n        render: function() {\r\n            this.$el.html(this.template());\r\n            $(document.body).append(this.$el);\r\n            $('.modal').modal({\r\n                keyboard:true,\r\n                backdrop: 'static',\r\n                show:true\r\n                });\r\n            return this;\r\n        },\r\n        save: function() {\r\n            var newCat = new Cat();\r\n            var collection=this.collection;\r\n            pl = $('#cats-new-title_pl').val();\r\n            en = $('#cats-new-title_en').val();\r\n            if (pl != '') {\r\n                newCat.set({title_pl: pl});\r\n                this.modified = true;\r\n            }\r\n            if (en != '') {\r\n                newCat.set({title_en:en});\r\n                this.modified = true;\r\n            }\r\n            if (this.modified) {\r\n                 \r\n                me = this;\r\n                $('#ajax-loader').show();\r\n                newCat.create({\r\n                    success: function(model) {\r\n                        collection.add(model);\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('success');\r\n                        $('.modal').modal('hide');\r\n                    },\r\n                    error: function(model, response) {\r\n                        mainView.showAlert('error');\r\n                        $('.modal').modal('hide');\r\n                    }\r\n                });\r\n            }\r\n            else{\r\n                alert('You havent made any changes');\r\n            }\r\n            return this;\r\n        },\r\n        hide:function(){\r\n            //check for changes if changes made then prompt to save yes/no\r\n            pl=$('#cats-new-title_pl').val();\r\n            en=$('#cats-new-title_en').val();\r\n            //console.debug(pl);\r\n        if (pl !== '' || en !== '') {\r\n            var r = confirm('You have unsaved data are you sure you want to leave?');\r\n            if (r == true) {\r\n                $('.modal').modal('hide');\r\n            }\r\n            }\r\n        else $('.modal').modal('hide');\r\n        },\r\n        justClose: function() {\r\n        //    this.remove();\r\n            afrykaAdminApp.mm.closeView(this);\r\n        }  \r\n    });\r\n    var EditStatusModalView = Backbone.View.extend({\r\n        events: {\r\n            'click .modal-close':'hide',\r\n            'hidden .modal':'justClose',\r\n            'click #statii-edit-btn-save':'save',\r\n            'click #statii-edit-btn-delete':'delete'\r\n        },\r\n        modified:false,\r\n        initialize: function() {\r\n            this.template = _.template($('#item-statii-edit').html());\r\n        },\r\n        render: function() {\r\n            this.$el.html(this.template(this.model.toJSON()));\r\n            $(document.body).append(this.$el);\r\n            $('.modal').modal({\r\n                keyboard:true,\r\n                backdrop: 'static',\r\n                show:true\r\n                });\r\n            return this;\r\n        },\r\n        hide:function(){\r\n            //check for changes if changes made then prompt to save yes/no\r\n            nm = $('#statii-edit-name').val();\r\n            des = $('#statii-edit-description').val();\r\n            desEl = $('#statii-edit-description');\r\n        if (nm !== '' || des !== desEl.data('oldcontent')) {\r\n            var r = confirm('You have unsaved data are you sure you want to leave?');\r\n            if (r == true) {\r\n                $('.modal').modal('hide');\r\n            }\r\n            }\r\n        else $('.modal').modal('hide');\r\n        },\r\n        justClose: function() {\r\n        //    this.remove();\r\n            afrykaAdminApp.mm.closeView(this);\r\n        },\r\n        save: function() {\r\n            var updated = {};\r\n            var nm = $('#statii-edit-name').val();\r\n            var des = $('#statii-edit-description').val();\r\n            var desEl=$('#statii-edit-description');\r\n            if (nm != '') {\r\n                updated.name = nm;\r\n                this.modified = true;\r\n            }\r\n            if (des !== desEl.data('oldcontent')) {\r\n                updated.description = des;\r\n                this.modified = true;\r\n            }\r\n            if (this.modified) {\r\n                //me = this;\r\n                $('#ajax-loader').show();\r\n                console.debug(updated)\r\n                this.model.save(updated, {\r\n                    success: function(model) {\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('success');\r\n                        $('.modal').modal('hide');\r\n                    },\r\n                    error: function(model, response) {\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('error');\r\n                        $('.modal').modal('hide');\r\n                    }\r\n                });\r\n            }\r\n            return this; \r\n        },\r\n        delete: function() {\r\n            var r = confirm('Are you sure you want to delete this status?');\r\n            if (r == true) {\r\n                $('#ajax-loader').show();\r\n                this.model.destroy({\r\n                    success: function(model) {\r\n                        console.debug(model.toJSON());\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('success');\r\n                        $('.modal').modal('hide');\r\n                    },\r\n                    error: function(model, response) {\r\n                        //strange things going on here\r\n                        //the error callback is being called even though the model is deleted\r\n                        console.debug(model);\r\n                        console.debug(response);\r\n                        $('#ajax-loader').hide();\r\n                        $('.modal').modal('hide');\r\n                        //mainView.showAlert('error');\r\n                    }\r\n                });\r\n            }\r\n        }\r\n           \r\n    });\r\n    var NewStatusModalView = Backbone.View.extend({\r\n        events: {\r\n            'click .modal-close':'hide',\r\n            'hidden .modal':'justClose',\r\n            'click #statii-new-btn-save':'save'\r\n        },\r\n        initialize: function() {\r\n            this.template = _.template($('#item-statii-new').html());\r\n        },\r\n        render: function() {\r\n            this.$el.html(this.template());\r\n            $(document.body).append(this.$el);\r\n            $('.modal').modal({\r\n                keyboard:true,\r\n                backdrop: 'static',\r\n                show:true\r\n                });\r\n            return this;\r\n        },\r\n        hide:function(){\r\n            //check for changes if changes made then prompt to save yes/no\r\n            nm = $('#statii-new-name').val();\r\n            des = $('#statii-new-description').val();\r\n        if (nm !== '' || des !== '') {\r\n            var r = confirm('You have unsaved data are you sure you want to leave?');\r\n            if (r == true) {\r\n                $('.modal').modal('hide');\r\n            }\r\n            }\r\n        else $('.modal').modal('hide');\r\n        },\r\n        justClose: function() {\r\n        //    this.remove();\r\n            afrykaAdminApp.mm.closeView(this);\r\n        },\r\n        save: function() {\r\n            var newStatus= new Status();\r\n            var collection= this.collection;\r\n            nm = $('#statii-new-name').val();\r\n            des = $('#statii-new-description').val();\r\n            if (nm !== '') {\r\n                newStatus.set({name:nm});\r\n                this.modified = true;\r\n            }\r\n            if (des !== '') {\r\n                newStatus.set({description:des});\r\n                this.modified = true;\r\n            }\r\n            if (this.modified) {\r\n                //me = this;\r\n                $('#ajax-loader').show();\r\n                //console.debug(updated)\r\n                newStatus.create({\r\n                    success: function(model) {\r\n                        collection.add(model);\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('success');\r\n                        $('.modal').modal('hide');\r\n                    },\r\n                    error: function(model, response) {\r\n                        $('#ajax-loader').hide();\r\n                        mainView.showAlert('error');\r\n                        $('.modal').modal('hide');\r\n                    }\r\n                });\r\n            }\r\n            return this;\r\n        }\r\n           \r\n    });\r\n    ///////////////////////////////////////////////////////\r\n    function PageRegionManager() {\r\n        this.showView = function(view) {\r\n            if(this.currentView && this.currentView!==view) {\r\n                console.debug('prm: closing currentview');\r\n                this.currentView.close();\r\n            }\r\n            this.currentView = view;\r\n            //this.currentView.render();\r\n            $(\".view-container\").html(this.currentView.render().el);\r\n        }\r\n    }\r\n    function BodyRegionManager() { //for body top level views\r\n        this.showView = function(view) {\r\n            if (this.currentView !== view || $('body').html()==='') {\r\n                if (this.currentView && this.currentView !== view) {\r\n                    this.currentView.close();\r\n                }\r\n                else {\r\n                    $('body').empty();\r\n                    console.debug('brm: emptying body');\r\n                }\r\n                this.currentView = view;\r\n                //this.currentView.render();\r\n                //$(\"body\").html(this.currentView.render().el);\r\n                this.currentView.render();\r\n            }\r\n            else console.debug('cant close and open the same view');\r\n        }\r\n    }\r\n    function ModalManager(){\r\n        this.showView = function(view){\r\n            view.render();\r\n        }\r\n        this.closeView = function(view){\r\n            view.close();\r\n        }\r\n    }\r\n     \r\n    //////////////////////////////////////////////////////\r\n    var AppRouter = Backbone.Router.extend({\r\n        routes:{\r\n            '':'login',\r\n            'home':'main',\r\n            'products':'toProducts',\r\n            'product/:id':'toProduct',\r\n            'new/product':'toProductNew',\r\n            'categories':'toCats',\r\n            'statii':'toStatii',\r\n            'other':'toOther',\r\n            'problem':'toProblem',\r\n            'user/:id':'toUser'\r\n        },\r\n        initialize:function(){\r\n            this.prm = new PageRegionManager();\r\n            this.brm = new BodyRegionManager();\r\n            this.mm  = new ModalManager();\r\n            console.debug(this);\r\n        },\r\n        activeNav:function(newClass){\r\n            $('.active').removeClass('active');\r\n            $(newClass).addClass('active');\r\n            console.debug('activated:'+newClass);\r\n            console.debug($(newClass));\r\n        },\r\n        getUser:function(name){\r\n            if(!admin){\r\n            //console.debug('getUser:about to fetch user');\r\n            var user = new StackMob.User({username:name});\r\n            //console.debug('getUser:fetching user');\r\n            user.fetch({\r\n                success:function(){\r\n                    admin = user;\r\n                console.debug('user fetched');\r\n                console.debug(user);\r\n                },\r\n                error:function(){\r\n                    console.debug('user  fetch error');\r\n                    window.localStorage.clear(); \r\n                }\r\n            });\r\n           // return user;\r\n            }\r\n            else {\r\n                console.debug('admin already exists');\r\n                console.debug(admin);\r\n             //   return admin;\r\n                }\r\n        },\r\n        login:function(){\r\n            console.log(\"login route\");\r\n            $('body').empty();\r\n            ar = this;\r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                    //get user and navigate to home\r\n                    ar.getUser(username);\r\n                    ar.navigate('/home',true)\r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n        },\r\n        main:function(){\r\n            //check if user is logged on if user object is not there fetch it\r\n           $('#ajax-loader').show();\r\n            console.debug('main function :routing to main view');\r\n            ar = this;\r\n           \r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                   // ar.getUser(username);\r\n                    ////////////////////\r\n                    if (!admin) {\r\n                        console.debug('main:about to fetch user: '+username);\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                    \r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goHome(mainView);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                                window.localStorage.clear();\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                        if (!mainView){\r\n                            console.debug('mainview doesnt exist');\r\n                         mainView = new MainView({\r\n                                    model: admin\r\n                                });}\r\n                                else console.debug('mainview exists');\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goHome(mainView);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                    //get user and navigate to home\r\n                  //  afrykaAdminApp.navigate('/home',true)\r\n                    //ar.navigate('/home',true)\r\n                   \r\n                    \r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n            \r\n        },\r\n        toProducts:function(){\r\n             $('#ajax-loader').show();\r\n            console.debug('toproducts function :routing to products view');\r\n            ar = this;\r\n            \r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                    // ar.getUser(username);\r\n                    //get user and navigate to home\r\n                  //  afrykaAdminApp.navigate('/home',true)\r\n                    //ar.navigate('/home',true)\r\n                     ////////////////////\r\n                    if (!admin) {\r\n                        //console.debug('getUser:about to fetch user');\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                    \r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goProducts(mainView);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                                window.localStorage.clear();\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                        if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goProducts(mainView);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                    \r\n                    \r\n                   \r\n                    \r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n        },\r\n        toProduct:function(id){\r\n             $('#ajax-loader').show();\r\n              console.debug('toproduct function :routing to product');\r\n            ar = this;\r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                    if (!admin) {\r\n                        //console.debug('getUser:about to fetch user');\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                    \r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                               \r\n                              \r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goProduct(mainView,id);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                                window.localStorage.clear();\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                         if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goProduct(mainView,id);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                    \r\n                    \r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n        },\r\n        toProductNew:function(){\r\n            $('#ajax-loader').show();\r\n              console.debug('toproductnew function :routing to new product');\r\n            ar = this;\r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                    if (!admin) {\r\n                        //console.debug('getUser:about to fetch user');\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                              \r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goProductNew(mainView);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                         if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goProductNew(mainView);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n        },\r\n        toCats:function(){\r\n             $('#ajax-loader').show();\r\n            console.debug('tocats function :routing to catsview');\r\n            ar = this;\r\n            \r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                   //  ar.getUser(username);\r\n                    //get user and navigate to home\r\n                  //  afrykaAdminApp.navigate('/home',true)\r\n                    //ar.navigate('/home',true)\r\n                     ////////////////////\r\n                    if (!admin) {\r\n                        //console.debug('getUser:about to fetch user');\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                    \r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goCategories(mainView);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                                window.localStorage.clear();\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                         if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goCategories(mainView);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                     //user model to be passed into the constructor\r\n                    \r\n                    \r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n             \r\n        },\r\n        toStatii:function(){\r\n             $('#ajax-loader').show();\r\n            console.debug('to statii function :routing to statii view');\r\n            ar = this;\r\n            \r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                    if (!admin) {\r\n                        //console.debug('getUser:about to fetch user');\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                    \r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                               // mainView.sidebarVisible=false;//reset it in case the page was refreshed\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goStatii(mainView);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                                window.localStorage.clear();\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                        if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goStatii(mainView);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                    // user model to be passed into the constructor\r\n                   \r\n                    \r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n        },\r\n        toOther:function(){\r\n             $('#ajax-loader').show();\r\n            console.debug('to other function :routing to other view');\r\n            ar = this;\r\n           \r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                    // ar.getUser(username);\r\n                    //get user and navigate to home\r\n                  //  afrykaAdminApp.navigate('/home',true)\r\n                    //ar.navigate('/home',true)\r\n                     ////////////////////\r\n                    if (!admin) {\r\n                        //console.debug('getUser:about to fetch user');\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                    \r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                               // mainView.sidebarVisible=false;//reset it in case the page was refreshed\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goOther(mainView);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                                window.localStorage.clear();\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                        if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goOther(mainView);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                    // user model to be passed into the constructor\r\n                   \r\n                    \r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n        },\r\n        toProblem:function(){\r\n            console.debug('problem route fired');\r\n            ar.brm.showView(new ProblemView());\r\n        },\r\n        toUser:function(){\r\n             \r\n            console.debug('to statii function :routing to statii view');\r\n            ar = this;\r\n            StackMob.isLoggedIn({\r\n                yes:function(username){\r\n                    console.log(username+\" :is logged in\");\r\n                    if (!admin) {\r\n                        //console.debug('getUser:about to fetch user');\r\n                        var user = new StackMob.User({\r\n                            username: username\r\n                        });\r\n                        //console.debug('getUser:fetching user');\r\n                        user.fetch({\r\n                            success: function() {\r\n                                admin = user;\r\n                                console.debug('user fetched');\r\n                                console.debug(user);\r\n                    \r\n                                if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                               // mainView.sidebarVisible=false;//reset it in case the page was refreshed\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goUser(mainView);\r\n                            },\r\n                            error: function() {\r\n                                console.debug('user  fetch error');\r\n                                window.localStorage.clear();\r\n                            }\r\n                        });\r\n                        // return user;\r\n                    }\r\n                    else {\r\n                        console.debug('admin already exists');\r\n                        console.debug(admin);\r\n                        if (!mainView) mainView = new MainView({\r\n                                    model: admin\r\n                                });\r\n                                ar.brm.showView(mainView); // user model to be passed into the constructor\r\n                                mainView.goUser(mainView);\r\n                        //   return admin;\r\n                    }\r\n                    ////////////////////\r\n                    // user model to be passed into the constructor\r\n                   \r\n                    \r\n                },\r\n                no:function(){\r\n                    console.log(\"no user logged in\");\r\n                   ar.brm.showView(new LoginView());\r\n                }/*,\r\n                error:function(){\r\n                    console.log(\"error\");\r\n                }*/\r\n            });\r\n        },\r\n    });\r\n    afrykaAdminApp = new AppRouter();\r\n    console.log(\"app launched\")\r\n    Backbone.history.start();\r\n    console.log(\"backbone history start\")\r\n});\r\n"]],"start1":0,"start2":0,"length1":0,"length2":116082}]],"length":116082,"saved":false}
{"ts":1365252794460,"patch":[[{"diffs":[[0,"n=statii"],[-1,"pr"],[0,"oducts;\r"]],"start1":65066,"start2":65066,"length1":18,"length2":16}]],"length":116080,"saved":false}
{"ts":1365252797478,"patch":[[{"diffs":[[0,"n=statii"],[-1,"oducts"],[0,";\r\n     "]],"start1":65066,"start2":65066,"length1":22,"length2":16}]],"length":116074,"saved":false}
{"ts":1365252818482,"patch":[[{"diffs":[[0,"this.collection="],[1,"ca"],[0,"products;\r\n     "]],"start1":60806,"start2":60806,"length1":32,"length2":34}]],"length":116076,"saved":false}
{"ts":1365252820900,"patch":[[{"diffs":[[0,"ction=ca"],[-1,"produc"],[0,"ts;\r\n   "]],"start1":60816,"start2":60816,"length1":22,"length2":16}]],"length":116070,"saved":false}
